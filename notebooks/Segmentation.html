<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Segmentation &#8212; spatialproteomics</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css?v=a123c646" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script src="../_static/documentation_options.js?v=b9678aa1"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js?v=dbd2e957"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Interactive Removal of Artifacts" href="ArtifactRemoval.html" />
    <link rel="prev" title="Subselecting Data" href="Slicing.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  
  <h1 class="site-logo" id="site-title">spatialproteomics</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent" role="heading">
 <span class="caption-text">
  Contents:
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../preprocessing.html">
   The preprocessing (
   <code class="code docutils literal notranslate">
    <span class="pre">
     pp
    </span>
   </code>
   ) accessor
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../label.html">
   The label (
   <code class="code docutils literal notranslate">
    <span class="pre">
     la
    </span>
   </code>
   ) accessor
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../neighborhood.html">
   The neighborhood (
   <code class="code docutils literal notranslate">
    <span class="pre">
     nh
    </span>
   </code>
   ) accessor
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../plot.html">
   The plot (
   <code class="code docutils literal notranslate">
    <span class="pre">
     pl
    </span>
   </code>
   ) accessor
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tool.html">
   The tool (
   <code class="code docutils literal notranslate">
    <span class="pre">
     tl
    </span>
   </code>
   ) accessor
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../image_container.html">
   The image container
  </a>
 </li>
</ul>
<p class="caption collapsible-parent" role="heading">
 <span class="caption-text">
  Tutorials:
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="Installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ExampleWorkflow.html">
   Example Workflow with spatialproteomics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ExampleWorkflowSpatialdata.html">
   Example Workflow with spatialproteomics and spatialdata
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Slicing.html">
   Subselecting Data
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Segmentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ArtifactRemoval.html">
   Interactive Removal of Artifacts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Plotting.html">
   Plotting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ImageProcessing.html">
   Image Processing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="CellTypePrediction.html">
   Cell Type Prediction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Neighborhoods.html">
   Neighborhood Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Interoperability.html">
   Interoperability
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Interactivity.html">
   Interactivity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="FAQ.html">
   FAQ
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/Segmentation.ipynb.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Whole-Cell-Segmentation-with-Cellpose">
   Whole-Cell Segmentation with Cellpose
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Whole-Cell-Segmentation-with-Mesmer">
   Whole-Cell Segmentation with Mesmer
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Nuclear-Segmentation-with-StarDist">
   Nuclear Segmentation with StarDist
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Segmenting-Multiple-Channels-with-Cellpose">
   Segmenting Multiple Channels with Cellpose
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Merging-Segmentation-Masks-from-Different-Layers">
   Merging Segmentation Masks from Different Layers
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Segmentation">
<h1>Segmentation<a class="headerlink" href="#Segmentation" title="Link to this heading">¶</a></h1>
<p>Segmentation describes the process of finding cells in an image. This can be done either on the nucleus or on whole cell level. Spatialproteomics provides wrappers for StarDist, mesmer and cellpose.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">reload_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">spatialproteomics</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># loading the input data</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_zarr</span><span class="p">(</span><span class="s2">&quot;../../data/segmentation_example.zarr&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="mi">1000</span><span class="p">:</span><span class="mi">1300</span><span class="p">,</span> <span class="mi">1000</span><span class="p">:</span><span class="mi">1300</span><span class="p">]</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">drop_layers</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s2">&quot;_image&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># checking what the object initially looks like</span>
<span class="n">ds</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:   (channels: 4, y: 301, x: 301)
Coordinates:
  * channels  (channels) &lt;U11 &#x27;DAPI&#x27; &#x27;Na/K ATPase&#x27; &#x27;CD68&#x27; &#x27;CD11c&#x27;
  * x         (x) int64 1000 1001 1002 1003 1004 ... 1296 1297 1298 1299 1300
  * y         (y) int64 1000 1001 1002 1003 1004 ... 1296 1297 1298 1299 1300
Data variables:
    _image    (channels, y, x) uint8 dask.array&lt;chunksize=(4, 301, 301), meta=np.ndarray&gt;</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-079a03e3-5b5a-43c7-b1df-e62999c7b993' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-079a03e3-5b5a-43c7-b1df-e62999c7b993' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>channels</span>: 4</li><li><span class='xr-has-index'>y</span>: 301</li><li><span class='xr-has-index'>x</span>: 301</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-b7df562d-99a2-40b3-9d73-6bd2e391de52' class='xr-section-summary-in' type='checkbox'  checked><label for='section-b7df562d-99a2-40b3-9d73-6bd2e391de52' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>channels</span></div><div class='xr-var-dims'>(channels)</div><div class='xr-var-dtype'>&lt;U11</div><div class='xr-var-preview xr-preview'>&#x27;DAPI&#x27; &#x27;Na/K ATPase&#x27; &#x27;CD68&#x27; &#x27;CD11c&#x27;</div><input id='attrs-6f457c89-5b83-48db-a753-6d38c4915fc9' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-6f457c89-5b83-48db-a753-6d38c4915fc9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ddd69aee-4bb3-4175-a5a8-f975c04c58bf' class='xr-var-data-in' type='checkbox'><label for='data-ddd69aee-4bb3-4175-a5a8-f975c04c58bf' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;DAPI&#x27;, &#x27;Na/K ATPase&#x27;, &#x27;CD68&#x27;, &#x27;CD11c&#x27;], dtype=&#x27;&lt;U11&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>x</span></div><div class='xr-var-dims'>(x)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1000 1001 1002 ... 1298 1299 1300</div><input id='attrs-81b300e2-1d66-43b0-978f-3aa3befac910' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-81b300e2-1d66-43b0-978f-3aa3befac910' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9f3a157f-5ba3-4c4f-8051-cafea0108617' class='xr-var-data-in' type='checkbox'><label for='data-9f3a157f-5ba3-4c4f-8051-cafea0108617' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1000, 1001, 1002, ..., 1298, 1299, 1300])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>y</span></div><div class='xr-var-dims'>(y)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1000 1001 1002 ... 1298 1299 1300</div><input id='attrs-de9ad971-5dc1-46a6-9fed-cb4ba80d0e24' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-de9ad971-5dc1-46a6-9fed-cb4ba80d0e24' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0730c8dd-dae8-4d0a-949d-02322cddfb09' class='xr-var-data-in' type='checkbox'><label for='data-0730c8dd-dae8-4d0a-949d-02322cddfb09' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1000, 1001, 1002, ..., 1298, 1299, 1300])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-d672804e-627f-4ffd-90da-69dc0802f250' class='xr-section-summary-in' type='checkbox'  checked><label for='section-d672804e-627f-4ffd-90da-69dc0802f250' class='xr-section-summary' >Data variables: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>_image</span></div><div class='xr-var-dims'>(channels, y, x)</div><div class='xr-var-dtype'>uint8</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(4, 301, 301), meta=np.ndarray&gt;</div><input id='attrs-6bc6aa06-4c85-40d7-97bd-3d1617aadffd' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-6bc6aa06-4c85-40d7-97bd-3d1617aadffd' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-067ef19f-d822-4d1b-9782-d3c8bbcba553' class='xr-var-data-in' type='checkbox'><label for='data-067ef19f-d822-4d1b-9782-d3c8bbcba553' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>

                    <tr>
                        <th> Bytes </th>
                        <td> 353.91 kiB </td>
                        <td> 353.91 kiB </td>
                    </tr>

                    <tr>
                        <th> Shape </th>
                        <td> (4, 301, 301) </td>
                        <td> (4, 301, 301) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 1 chunks in 3 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> uint8 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="195" height="185" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="25" y2="15" style="stroke-width:2" />
  <line x1="10" y1="120" x2="25" y2="135" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="120" style="stroke-width:2" />
  <line x1="25" y1="15" x2="25" y2="135" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 25.77971986703342,15.779719867033421 25.77971986703342,135.7797198670334 10.0,120.0" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="130" y2="0" style="stroke-width:2" />
  <line x1="25" y1="15" x2="145" y2="15" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="25" y2="15" style="stroke-width:2" />
  <line x1="130" y1="0" x2="145" y2="15" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 130.0,0.0 145.7797198670334,15.779719867033421 25.77971986703342,15.779719867033421" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="25" y1="15" x2="145" y2="15" style="stroke-width:2" />
  <line x1="25" y1="135" x2="145" y2="135" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="25" y1="15" x2="25" y2="135" style="stroke-width:2" />
  <line x1="145" y1="15" x2="145" y2="135" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="25.77971986703342,15.779719867033421 145.7797198670334,15.779719867033421 145.7797198670334,135.7797198670334 25.77971986703342,135.7797198670334" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="85.779720" y="155.779720" font-size="1.0rem" font-weight="100" text-anchor="middle" >301</text>
  <text x="165.779720" y="75.779720" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,165.779720,75.779720)">301</text>
  <text x="7.889860" y="147.889860" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,7.889860,147.889860)">4</text>
</svg>
        </td>
    </tr>
</table></div></li></ul></div></li><li class='xr-section-item'><input id='section-ef22cabb-4b45-435b-9882-605eeef2f047' class='xr-section-summary-in' type='checkbox'  ><label for='section-ef22cabb-4b45-435b-9882-605eeef2f047' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>channels</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-76e46447-1994-4888-8509-dd0910ab23a6' class='xr-index-data-in' type='checkbox'/><label for='index-76e46447-1994-4888-8509-dd0910ab23a6' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;DAPI&#x27;, &#x27;Na/K ATPase&#x27;, &#x27;CD68&#x27;, &#x27;CD11c&#x27;], dtype=&#x27;object&#x27;, name=&#x27;channels&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>x</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-1d5a521d-0712-46b6-a9ed-d01ae2479574' class='xr-index-data-in' type='checkbox'/><label for='index-1d5a521d-0712-46b6-a9ed-d01ae2479574' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([1000, 1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009,
       ...
       1291, 1292, 1293, 1294, 1295, 1296, 1297, 1298, 1299, 1300],
      dtype=&#x27;int64&#x27;, name=&#x27;x&#x27;, length=301))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>y</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-37267779-788d-4969-bc7b-edde4ae57170' class='xr-index-data-in' type='checkbox'/><label for='index-37267779-788d-4969-bc7b-edde4ae57170' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([1000, 1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009,
       ...
       1291, 1292, 1293, 1294, 1295, 1296, 1297, 1298, 1299, 1300],
      dtype=&#x27;int64&#x27;, name=&#x27;y&#x27;, length=301))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-51fbcede-4723-4145-8f06-196478f5ef20' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-51fbcede-4723-4145-8f06-196478f5ef20' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div>
</div>
<section id="Whole-Cell-Segmentation-with-Cellpose">
<h2>Whole-Cell Segmentation with Cellpose<a class="headerlink" href="#Whole-Cell-Segmentation-with-Cellpose" title="Link to this heading">¶</a></h2>
<p>Cellpose can either perform segmentation on nuclei only or on whole cells, using a nuclear and a membrane marker. In this dataset, we have DAPI as a nuclear marker and Na/K ATPase as a membrane marker. After selecting only the relevant markers, we need to tell cellpose at what position each marker is. You can refer to the <a class="reference external" href="https://cellpose.readthedocs.io/en/latest/settings.html">cellpose documentation</a> for more details.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># running the segmentation on the selected markers</span>
<span class="n">ds_cellpose</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">cellpose</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Na/K ATPase&quot;</span><span class="p">,</span> <span class="s2">&quot;DAPI&quot;</span><span class="p">],</span> <span class="n">channel_settings</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">ds_cellpose</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Neither TORCH CUDA nor MPS version not installed/working.
&gt;&gt;&gt;&gt; using CPU
&gt;&gt;&gt;&gt; using CPU
&gt;&gt; cyto3 &lt;&lt; model set to be used
&gt;&gt;&gt;&gt; loading model /home/meyerben/.cellpose/models/cyto3
/home/meyerben/meyerben/.conda/envs/tmp_env_2/lib/python3.10/site-packages/cellpose/resnet_torch.py:280: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don&#39;t have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  state_dict = torch.load(filename, map_location=torch.device(&#34;cpu&#34;))
&gt;&gt;&gt;&gt; model diam_mean =  30.000 (ROIs rescaled to this size during training)
channels set to [1, 2]
~~~ ESTIMATING CELL DIAMETER(S) ~~~
estimated cell diameter(s) in 12.00 sec
&gt;&gt;&gt; diameter(s) =
[ 17.97 ]
~~~ FINDING MASKS ~~~
&gt;&gt;&gt;&gt; TOTAL TIME 29.72 sec
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:        (channels: 4, y: 301, x: 301, cells: 330, features: 2)
Coordinates:
  * channels       (channels) &lt;U11 &#x27;DAPI&#x27; &#x27;Na/K ATPase&#x27; &#x27;CD68&#x27; &#x27;CD11c&#x27;
  * x              (x) int64 1000 1001 1002 1003 1004 ... 1297 1298 1299 1300
  * y              (y) int64 1000 1001 1002 1003 1004 ... 1297 1298 1299 1300
  * cells          (cells) int64 1 2 3 4 5 6 7 8 ... 324 325 326 327 328 329 330
  * features       (features) &lt;U10 &#x27;centroid-0&#x27; &#x27;centroid-1&#x27;
Data variables:
    _image         (channels, y, x) uint8 dask.array&lt;chunksize=(4, 301, 301), meta=np.ndarray&gt;
    _segmentation  (y, x) uint16 0 1 1 1 1 1 1 1 ... 324 324 324 324 324 324 0
    _obs           (cells, features) float64 1.005e+03 1.011e+03 ... 1.003e+03</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-a93b0d73-cb57-4aaa-97f3-6f6469952397' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-a93b0d73-cb57-4aaa-97f3-6f6469952397' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>channels</span>: 4</li><li><span class='xr-has-index'>y</span>: 301</li><li><span class='xr-has-index'>x</span>: 301</li><li><span class='xr-has-index'>cells</span>: 330</li><li><span class='xr-has-index'>features</span>: 2</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-11df11bb-8a5f-42f9-865a-e88d3902da59' class='xr-section-summary-in' type='checkbox'  checked><label for='section-11df11bb-8a5f-42f9-865a-e88d3902da59' class='xr-section-summary' >Coordinates: <span>(5)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>channels</span></div><div class='xr-var-dims'>(channels)</div><div class='xr-var-dtype'>&lt;U11</div><div class='xr-var-preview xr-preview'>&#x27;DAPI&#x27; &#x27;Na/K ATPase&#x27; &#x27;CD68&#x27; &#x27;CD11c&#x27;</div><input id='attrs-b0c73c63-1fd7-49d3-880a-b73d5ff384ec' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-b0c73c63-1fd7-49d3-880a-b73d5ff384ec' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8b857b50-8ae1-4022-b5ec-8472b886e9d5' class='xr-var-data-in' type='checkbox'><label for='data-8b857b50-8ae1-4022-b5ec-8472b886e9d5' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;DAPI&#x27;, &#x27;Na/K ATPase&#x27;, &#x27;CD68&#x27;, &#x27;CD11c&#x27;], dtype=&#x27;&lt;U11&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>x</span></div><div class='xr-var-dims'>(x)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1000 1001 1002 ... 1298 1299 1300</div><input id='attrs-b55e326b-bb9b-411f-bb12-548a9f9cf89e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-b55e326b-bb9b-411f-bb12-548a9f9cf89e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-81a2b08f-b79a-41f7-8802-907f82bcb9a2' class='xr-var-data-in' type='checkbox'><label for='data-81a2b08f-b79a-41f7-8802-907f82bcb9a2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1000, 1001, 1002, ..., 1298, 1299, 1300])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>y</span></div><div class='xr-var-dims'>(y)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1000 1001 1002 ... 1298 1299 1300</div><input id='attrs-0bd0e014-aa0e-42f8-8efd-922144b183a7' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-0bd0e014-aa0e-42f8-8efd-922144b183a7' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4799d30c-1d74-40be-90af-c5a3ac1ab83f' class='xr-var-data-in' type='checkbox'><label for='data-4799d30c-1d74-40be-90af-c5a3ac1ab83f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1000, 1001, 1002, ..., 1298, 1299, 1300])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>cells</span></div><div class='xr-var-dims'>(cells)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 2 3 4 5 6 ... 326 327 328 329 330</div><input id='attrs-fbd4c040-1d31-444b-a290-03c7b821f432' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-fbd4c040-1d31-444b-a290-03c7b821f432' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4a321a3b-cb36-4884-8659-5f11a501e73d' class='xr-var-data-in' type='checkbox'><label for='data-4a321a3b-cb36-4884-8659-5f11a501e73d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([  1,   2,   3, ..., 328, 329, 330])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>features</span></div><div class='xr-var-dims'>(features)</div><div class='xr-var-dtype'>&lt;U10</div><div class='xr-var-preview xr-preview'>&#x27;centroid-0&#x27; &#x27;centroid-1&#x27;</div><input id='attrs-9438bd21-b196-45b6-a345-6594878f983c' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9438bd21-b196-45b6-a345-6594878f983c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5ea2bfca-d297-4ee2-ae52-7aaa47a964d4' class='xr-var-data-in' type='checkbox'><label for='data-5ea2bfca-d297-4ee2-ae52-7aaa47a964d4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;centroid-0&#x27;, &#x27;centroid-1&#x27;], dtype=&#x27;&lt;U10&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-191a8da9-6fec-46b0-a603-b5b0b0939540' class='xr-section-summary-in' type='checkbox'  checked><label for='section-191a8da9-6fec-46b0-a603-b5b0b0939540' class='xr-section-summary' >Data variables: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>_image</span></div><div class='xr-var-dims'>(channels, y, x)</div><div class='xr-var-dtype'>uint8</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(4, 301, 301), meta=np.ndarray&gt;</div><input id='attrs-b23b2fda-9bb5-4ef5-8dbb-473f103575a3' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-b23b2fda-9bb5-4ef5-8dbb-473f103575a3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-35175061-2107-4539-90b9-145b10a03cd1' class='xr-var-data-in' type='checkbox'><label for='data-35175061-2107-4539-90b9-145b10a03cd1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>

                    <tr>
                        <th> Bytes </th>
                        <td> 353.91 kiB </td>
                        <td> 353.91 kiB </td>
                    </tr>

                    <tr>
                        <th> Shape </th>
                        <td> (4, 301, 301) </td>
                        <td> (4, 301, 301) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 1 chunks in 3 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> uint8 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="195" height="185" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="25" y2="15" style="stroke-width:2" />
  <line x1="10" y1="120" x2="25" y2="135" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="120" style="stroke-width:2" />
  <line x1="25" y1="15" x2="25" y2="135" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 25.77971986703342,15.779719867033421 25.77971986703342,135.7797198670334 10.0,120.0" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="130" y2="0" style="stroke-width:2" />
  <line x1="25" y1="15" x2="145" y2="15" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="25" y2="15" style="stroke-width:2" />
  <line x1="130" y1="0" x2="145" y2="15" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 130.0,0.0 145.7797198670334,15.779719867033421 25.77971986703342,15.779719867033421" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="25" y1="15" x2="145" y2="15" style="stroke-width:2" />
  <line x1="25" y1="135" x2="145" y2="135" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="25" y1="15" x2="25" y2="135" style="stroke-width:2" />
  <line x1="145" y1="15" x2="145" y2="135" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="25.77971986703342,15.779719867033421 145.7797198670334,15.779719867033421 145.7797198670334,135.7797198670334 25.77971986703342,135.7797198670334" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="85.779720" y="155.779720" font-size="1.0rem" font-weight="100" text-anchor="middle" >301</text>
  <text x="165.779720" y="75.779720" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,165.779720,75.779720)">301</text>
  <text x="7.889860" y="147.889860" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,7.889860,147.889860)">4</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>_segmentation</span></div><div class='xr-var-dims'>(y, x)</div><div class='xr-var-dtype'>uint16</div><div class='xr-var-preview xr-preview'>0 1 1 1 1 1 ... 324 324 324 324 0</div><input id='attrs-3898a701-f446-4e33-8aa4-0cfd4bcb8e3d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3898a701-f446-4e33-8aa4-0cfd4bcb8e3d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-babbced1-240f-4a27-9e6b-cef3eafcfd29' class='xr-var-data-in' type='checkbox'><label for='data-babbced1-240f-4a27-9e6b-cef3eafcfd29' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[  0,   1,   1, ...,  16,  16,  16],
       [  1,   1,   1, ...,  16,  16,  16],
       [  1,   1,   1, ...,  16,  16,  16],
       ...,
       [330, 330, 330, ..., 324, 324, 324],
       [330, 330, 330, ..., 324, 324, 324],
       [330, 330, 330, ..., 324, 324,   0]], dtype=uint16)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>_obs</span></div><div class='xr-var-dims'>(cells, features)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>1.005e+03 1.011e+03 ... 1.003e+03</div><input id='attrs-f9be6052-28c2-41e5-a588-3db223a6dcb5' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f9be6052-28c2-41e5-a588-3db223a6dcb5' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8cbb0c26-95a7-426b-a2ad-d9e515c71ad6' class='xr-var-data-in' type='checkbox'><label for='data-8cbb0c26-95a7-426b-a2ad-d9e515c71ad6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[1005.44486692, 1011.45247148],
       [1009.18024691, 1033.65185185],
       [1002.6344086 , 1051.02150538],
       [1003.13888889, 1063.79166667],
       [1011.87784091, 1070.73011364],
       [1006.68398268, 1088.68398268],
       [1004.97841727, 1103.        ],
       [1002.46753247, 1119.64935065],
       [1004.8343949 , 1132.65605096],
       [1007.52674897, 1147.69958848],
       [1007.02491103, 1165.59430605],
       [1003.45833333, 1177.80555556],
       [1004.65697674, 1207.00581395],
       [1003.34536082, 1257.71134021],
       [1004.11458333, 1279.29166667],
       [1004.375     , 1296.79166667],
       [1009.54375   , 1190.071875  ],
       [1010.24773414, 1222.36555891],
       [1010.77003484, 1239.20557491],
       [1010.98924731, 1111.97311828],
...
       [1278.83141762, 1143.        ],
       [1279.9030837 , 1030.79295154],
       [1282.31125828, 1295.36423841],
       [1288.2875817 , 1120.708061  ],
       [1289.25964912, 1040.62807018],
       [1285.59235669, 1177.84394904],
       [1286.17525773, 1260.2628866 ],
       [1291.04333333, 1198.57      ],
       [1291.76452599, 1237.55045872],
       [1292.89776358, 1138.1341853 ],
       [1292.83713355, 1216.22149837],
       [1293.02068966, 1056.47241379],
       [1293.96491228, 1097.3754386 ],
       [1294.05338078, 1288.34875445],
       [1292.54597701, 1010.23563218],
       [1295.40883978, 1074.14364641],
       [1295.50806452, 1251.9516129 ],
       [1295.56353591, 1268.74585635],
       [1295.94805195, 1182.46103896],
       [1296.91935484, 1003.46774194]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-6ef5e48a-efcf-4fe3-88f4-4bef219975a8' class='xr-section-summary-in' type='checkbox'  ><label for='section-6ef5e48a-efcf-4fe3-88f4-4bef219975a8' class='xr-section-summary' >Indexes: <span>(5)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>channels</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-9d51f683-701b-43a4-b613-51fbb10013a6' class='xr-index-data-in' type='checkbox'/><label for='index-9d51f683-701b-43a4-b613-51fbb10013a6' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;DAPI&#x27;, &#x27;Na/K ATPase&#x27;, &#x27;CD68&#x27;, &#x27;CD11c&#x27;], dtype=&#x27;object&#x27;, name=&#x27;channels&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>x</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-35be2f4f-7ab3-4910-ac2f-dde5b0c7f565' class='xr-index-data-in' type='checkbox'/><label for='index-35be2f4f-7ab3-4910-ac2f-dde5b0c7f565' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([1000, 1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009,
       ...
       1291, 1292, 1293, 1294, 1295, 1296, 1297, 1298, 1299, 1300],
      dtype=&#x27;int64&#x27;, name=&#x27;x&#x27;, length=301))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>y</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-7929438d-b62d-4f67-a4be-d45e3230e262' class='xr-index-data-in' type='checkbox'/><label for='index-7929438d-b62d-4f67-a4be-d45e3230e262' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([1000, 1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009,
       ...
       1291, 1292, 1293, 1294, 1295, 1296, 1297, 1298, 1299, 1300],
      dtype=&#x27;int64&#x27;, name=&#x27;y&#x27;, length=301))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>cells</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-1c65a43b-3485-471c-9654-5c5004a33379' class='xr-index-data-in' type='checkbox'/><label for='index-1c65a43b-3485-471c-9654-5c5004a33379' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([  1,   2,   3,   4,   5,   6,   7,   8,   9,  10,
       ...
       321, 322, 323, 324, 325, 326, 327, 328, 329, 330],
      dtype=&#x27;int64&#x27;, name=&#x27;cells&#x27;, length=330))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>features</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-03e2a7f8-61ff-4e71-8a5a-b35bec77aaaa' class='xr-index-data-in' type='checkbox'/><label for='index-03e2a7f8-61ff-4e71-8a5a-b35bec77aaaa' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;centroid-0&#x27;, &#x27;centroid-1&#x27;], dtype=&#x27;object&#x27;, name=&#x27;features&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-658b571a-ac1d-4666-9936-ceeff6b24a45' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-658b571a-ac1d-4666-9936-ceeff6b24a45' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for plotting, we subselect the two markers from before, but you could also show the other markers</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ds_cellpose</span><span class="o">.</span><span class="n">pp</span><span class="p">[[</span><span class="s2">&quot;Na/K ATPase&quot;</span><span class="p">,</span> <span class="s2">&quot;DAPI&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">colorize</span><span class="p">([</span><span class="s2">&quot;deepskyblue&quot;</span><span class="p">,</span> <span class="s2">&quot;gold&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">render_segmentation</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Segmentation_7_0.png" src="../_images/notebooks_Segmentation_7_0.png" />
</div>
</div>
</section>
<section id="Whole-Cell-Segmentation-with-Mesmer">
<h2>Whole-Cell Segmentation with Mesmer<a class="headerlink" href="#Whole-Cell-Segmentation-with-Mesmer" title="Link to this heading">¶</a></h2>
<p>You can also do the same thing with mesmer. Note however that mesmer expects the channels to be in the order <code class="docutils literal notranslate"><span class="pre">[nuclear,</span> <span class="pre">membrane]</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># running mesmer</span>
<span class="n">ds_mesmer</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">mesmer</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DAPI&quot;</span><span class="p">,</span> <span class="s2">&quot;Na/K ATPase&quot;</span><span class="p">])</span>
<span class="c1"># plotting the result</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ds_mesmer</span><span class="o">.</span><span class="n">pp</span><span class="p">[[</span><span class="s2">&quot;DAPI&quot;</span><span class="p">,</span> <span class="s2">&quot;Na/K ATPase&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">colorize</span><span class="p">([</span><span class="s2">&quot;gold&quot;</span><span class="p">,</span> <span class="s2">&quot;deepskyblue&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">render_segmentation</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2025-04-26 10:34:56.665731: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libcudart.so.11.0&#39;; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /g/huber/users/meyerben/.conda/envs/tmp_env_2/lib/python3.10/site-packages/cv2/../../lib64:
2025-04-26 10:34:56.665762: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.
Checking for cached data
Checking MultiplexSegmentation-9.tar.gz against provided file_hash...
MultiplexSegmentation-9.tar.gz with hash a1dfbce2594f927b9112f23a0a1739e0 already available.
Extracting /home/meyerben/.deepcell/models/MultiplexSegmentation-9.tar.gz
Successfully extracted /home/meyerben/.deepcell/models/MultiplexSegmentation-9.tar.gz into /home/meyerben/.deepcell/models
2025-04-26 10:35:54.735799: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libcuda.so.1&#39;; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /g/huber/users/meyerben/.conda/envs/tmp_env_2/lib/python3.10/site-packages/cv2/../../lib64:
2025-04-26 10:35:54.735830: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)
2025-04-26 10:35:54.735850: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (jupyter-meyerben): /proc/driver/nvidia/version does not exist
2025-04-26 10:35:54.768853: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Converting image dtype to float
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Segmentation_9_1.png" src="../_images/notebooks_Segmentation_9_1.png" />
</div>
</div>
</section>
<section id="Nuclear-Segmentation-with-StarDist">
<h2>Nuclear Segmentation with StarDist<a class="headerlink" href="#Nuclear-Segmentation-with-StarDist" title="Link to this heading">¶</a></h2>
<p>Sometimes, you may not have a membrane stain available. In that case, you can perform nuclear segmentation. This is possible with cellpose (simply call <code class="docutils literal notranslate"><span class="pre">tl.cellpose(channel='DAPI')</span></code>) and StarDist. The following shows and example of how StarDist performs on such a task.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># running stardist</span>
<span class="n">ds_stardist</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">stardist</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="s2">&quot;DAPI&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found model &#39;2D_versatile_fluo&#39; for &#39;StarDist2D&#39;.
Loading network weights from &#39;weights_best.h5&#39;.
Loading thresholds from &#39;thresholds.json&#39;.
Using default values: prob_thresh=0.479071, nms_thresh=0.3.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 144/144 [00:08&lt;00:00, 17.58it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plotting the segmentation</span>
<span class="n">fix</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ds_stardist</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;DAPI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ds_stardist</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;DAPI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">render_segmentation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Segmentation_12_0.png" src="../_images/notebooks_Segmentation_12_0.png" />
</div>
</div>
<p>You might have noticed that StarDist tends to segment a lot of small cells. Let’s look at the distribution of cell sizes, and then remove all nuclei under a certain size.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># getting a histogram of the areas</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ds_stardist</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">add_observations</span><span class="p">(</span><span class="s2">&quot;area&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">get_layer_as_df</span><span class="p">()[</span><span class="s2">&quot;area&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Segmentation_14_0.png" src="../_images/notebooks_Segmentation_14_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># removing cells which have an area below 50 pixels</span>
<span class="n">ds_stardist</span> <span class="o">=</span> <span class="n">ds_stardist</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">add_observations</span><span class="p">(</span><span class="s2">&quot;area&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">filter_by_obs</span><span class="p">(</span><span class="s2">&quot;area&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span>

<span class="c1"># plotting the segmentation</span>
<span class="n">fix</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ds_stardist</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;DAPI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ds_stardist</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;DAPI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">render_segmentation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Segmentation_15_0.png" src="../_images/notebooks_Segmentation_15_0.png" />
</div>
</div>
<p>To try to capture full cells, we can now grow the segmentation masks, e. g. by two pixels into each direction. If two masks collide, the masks will stop growing into that direction.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_stardist_grown</span> <span class="o">=</span> <span class="n">ds_stardist</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">grow_cells</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Mask growing requires recalculation of the observations. All features other than the centroids will be removed and should be recalculated with pp.add_observations().
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plotting the segmentation</span>
<span class="n">fix</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ds_stardist</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;DAPI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">render_segmentation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ds_stardist_grown</span><span class="o">.</span><span class="n">pp</span><span class="p">[</span><span class="s2">&quot;DAPI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">render_segmentation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;StarDist segmentation&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Grown masks&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Segmentation_18_0.png" src="../_images/notebooks_Segmentation_18_0.png" />
</div>
</div>
</section>
<section id="Segmenting-Multiple-Channels-with-Cellpose">
<h2>Segmenting Multiple Channels with Cellpose<a class="headerlink" href="#Segmenting-Multiple-Channels-with-Cellpose" title="Link to this heading">¶</a></h2>
<p>Next to predicting nuclei or whole cells using a universal membrane marker, you can also use cellpose to try to predict other cell types. In the following, we will see how we can use cellpose to segment three different channels independently and then merge the segmentation masks into one mask. There are some hyperparameters in cellpose which can help the prediction.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># segmenting on DAPI, CD11c (dendritic cells) and CD68 (macrophages)</span>
<span class="c1"># note that when merging the masks later, the order matters (channels take precedence by position in the subsetting)</span>
<span class="c1"># so you should have your largest cells first, and then go down by expected size</span>
<span class="n">ds_cellpose</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">pp</span><span class="p">[[</span><span class="s2">&quot;CD11c&quot;</span><span class="p">,</span> <span class="s2">&quot;CD68&quot;</span><span class="p">,</span> <span class="s2">&quot;DAPI&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">cellpose</span><span class="p">(</span><span class="n">key_added</span><span class="o">=</span><span class="s2">&quot;_cellpose_segmentation&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Neither TORCH CUDA nor MPS version not installed/working.
&gt;&gt;&gt;&gt; using CPU
&gt;&gt;&gt;&gt; using CPU
&gt;&gt; cyto3 &lt;&lt; model set to be used
&gt;&gt;&gt;&gt; loading model /home/meyerben/.cellpose/models/cyto3
resnet_torch.py (280): You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don&#39;t have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
&gt;&gt;&gt;&gt; model diam_mean =  30.000 (ROIs rescaled to this size during training)
Performing independent segmentation on all markers. If you want to perform joint segmentation, please set the channel_settings argument appropriately.
channels set to [0, 0]
~~~ ESTIMATING CELL DIAMETER(S) ~~~
estimated cell diameter(s) in 3.60 sec
&gt;&gt;&gt; diameter(s) =
[ 24.81 ]
~~~ FINDING MASKS ~~~
&gt;&gt;&gt;&gt; TOTAL TIME 7.16 sec
channels set to [0, 0]
~~~ ESTIMATING CELL DIAMETER(S) ~~~
estimated cell diameter(s) in 3.13 sec
&gt;&gt;&gt; diameter(s) =
[ 20.71 ]
~~~ FINDING MASKS ~~~
&gt;&gt;&gt;&gt; TOTAL TIME 8.02 sec
channels set to [0, 0]
~~~ ESTIMATING CELL DIAMETER(S) ~~~
estimated cell diameter(s) in 2.37 sec
&gt;&gt;&gt; diameter(s) =
[ 13.06 ]
~~~ FINDING MASKS ~~~
&gt;&gt;&gt;&gt; TOTAL TIME 6.59 sec
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_cellpose</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:                 (channels: 3, y: 301, x: 301)
Coordinates:
  * channels                (channels) &lt;U11 &#x27;CD11c&#x27; &#x27;CD68&#x27; &#x27;DAPI&#x27;
  * x                       (x) int64 1000 1001 1002 1003 ... 1298 1299 1300
  * y                       (y) int64 1000 1001 1002 1003 ... 1298 1299 1300
Data variables:
    _image                  (channels, y, x) uint8 dask.array&lt;chunksize=(3, 301, 301), meta=np.ndarray&gt;
    _cellpose_segmentation  (channels, y, x) uint16 0 0 0 0 0 0 ... 320 0 0 0 0</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-754bc075-a7cd-4d75-bfa7-86be97fa9376' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-754bc075-a7cd-4d75-bfa7-86be97fa9376' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>channels</span>: 3</li><li><span class='xr-has-index'>y</span>: 301</li><li><span class='xr-has-index'>x</span>: 301</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-80de6e8b-ed34-4828-971c-323853850ddb' class='xr-section-summary-in' type='checkbox'  checked><label for='section-80de6e8b-ed34-4828-971c-323853850ddb' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>channels</span></div><div class='xr-var-dims'>(channels)</div><div class='xr-var-dtype'>&lt;U11</div><div class='xr-var-preview xr-preview'>&#x27;CD11c&#x27; &#x27;CD68&#x27; &#x27;DAPI&#x27;</div><input id='attrs-55a1e9ce-4be6-45a8-82bc-3ca5ad061497' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-55a1e9ce-4be6-45a8-82bc-3ca5ad061497' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1bd81b65-3b1d-451b-9fe8-8e3ac1334438' class='xr-var-data-in' type='checkbox'><label for='data-1bd81b65-3b1d-451b-9fe8-8e3ac1334438' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;CD11c&#x27;, &#x27;CD68&#x27;, &#x27;DAPI&#x27;], dtype=&#x27;&lt;U11&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>x</span></div><div class='xr-var-dims'>(x)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1000 1001 1002 ... 1298 1299 1300</div><input id='attrs-ffb111af-caa2-47d1-b768-28f94223742a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ffb111af-caa2-47d1-b768-28f94223742a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-73bf1ccd-5ec3-4e75-93be-233e9ce139b3' class='xr-var-data-in' type='checkbox'><label for='data-73bf1ccd-5ec3-4e75-93be-233e9ce139b3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1000, 1001, 1002, ..., 1298, 1299, 1300])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>y</span></div><div class='xr-var-dims'>(y)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1000 1001 1002 ... 1298 1299 1300</div><input id='attrs-d5852ecf-82dd-4164-a8c0-b635545d89b0' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d5852ecf-82dd-4164-a8c0-b635545d89b0' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d2203300-26fa-4665-b728-cab5ff54bdce' class='xr-var-data-in' type='checkbox'><label for='data-d2203300-26fa-4665-b728-cab5ff54bdce' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1000, 1001, 1002, ..., 1298, 1299, 1300])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-b6c72d1f-df5f-46fd-bd7c-1d635409fb83' class='xr-section-summary-in' type='checkbox'  checked><label for='section-b6c72d1f-df5f-46fd-bd7c-1d635409fb83' class='xr-section-summary' >Data variables: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>_image</span></div><div class='xr-var-dims'>(channels, y, x)</div><div class='xr-var-dtype'>uint8</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(3, 301, 301), meta=np.ndarray&gt;</div><input id='attrs-7e63aa7a-f040-4c4e-adf3-f3f19e57d9ba' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-7e63aa7a-f040-4c4e-adf3-f3f19e57d9ba' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5ce958a2-dc70-4c09-bfaf-bffb882cd1d9' class='xr-var-data-in' type='checkbox'><label for='data-5ce958a2-dc70-4c09-bfaf-bffb882cd1d9' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>

                    <tr>
                        <th> Bytes </th>
                        <td> 265.43 kiB </td>
                        <td> 265.43 kiB </td>
                    </tr>

                    <tr>
                        <th> Shape </th>
                        <td> (3, 301, 301) </td>
                        <td> (3, 301, 301) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 1 chunks in 4 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> uint8 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="194" height="184" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="24" y2="14" style="stroke-width:2" />
  <line x1="10" y1="120" x2="24" y2="134" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="120" style="stroke-width:2" />
  <line x1="24" y1="14" x2="24" y2="134" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 24.9485979497544,14.948597949754403 24.9485979497544,134.9485979497544 10.0,120.0" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="130" y2="0" style="stroke-width:2" />
  <line x1="24" y1="14" x2="144" y2="14" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="24" y2="14" style="stroke-width:2" />
  <line x1="130" y1="0" x2="144" y2="14" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 130.0,0.0 144.9485979497544,14.948597949754403 24.9485979497544,14.948597949754403" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="24" y1="14" x2="144" y2="14" style="stroke-width:2" />
  <line x1="24" y1="134" x2="144" y2="134" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="24" y1="14" x2="24" y2="134" style="stroke-width:2" />
  <line x1="144" y1="14" x2="144" y2="134" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="24.9485979497544,14.948597949754403 144.9485979497544,14.948597949754403 144.9485979497544,134.9485979497544 24.9485979497544,134.9485979497544" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="84.948598" y="154.948598" font-size="1.0rem" font-weight="100" text-anchor="middle" >301</text>
  <text x="164.948598" y="74.948598" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,164.948598,74.948598)">301</text>
  <text x="7.474299" y="147.474299" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,7.474299,147.474299)">3</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>_cellpose_segmentation</span></div><div class='xr-var-dims'>(channels, y, x)</div><div class='xr-var-dtype'>uint16</div><div class='xr-var-preview xr-preview'>0 0 0 0 0 0 0 ... 320 320 0 0 0 0</div><input id='attrs-4a85e8cb-1ec6-4c53-abb1-860b2a5b4c62' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-4a85e8cb-1ec6-4c53-abb1-860b2a5b4c62' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1dfaf0ad-ba7c-47f7-9944-07bc1e44f308' class='xr-var-data-in' type='checkbox'><label for='data-1dfaf0ad-ba7c-47f7-9944-07bc1e44f308' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0],
        ...,
        [  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0]],

       [[  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0],
        ...,
        [  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0]],

       [[  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,  13,  13],
        [  0,   0,   0, ...,   0,  13,  13],
        ...,
        [322, 322, 322, ...,   0,   0,   0],
        [322, 322, 322, ...,   0,   0,   0],
        [322, 322, 322, ...,   0,   0,   0]]], dtype=uint16)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-fee394ca-d444-42b2-9840-9e690d8c3cb6' class='xr-section-summary-in' type='checkbox'  ><label for='section-fee394ca-d444-42b2-9840-9e690d8c3cb6' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>channels</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-c3893ba4-a798-44b2-acca-acdfe9a9d641' class='xr-index-data-in' type='checkbox'/><label for='index-c3893ba4-a798-44b2-acca-acdfe9a9d641' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;CD11c&#x27;, &#x27;CD68&#x27;, &#x27;DAPI&#x27;], dtype=&#x27;object&#x27;, name=&#x27;channels&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>x</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-88b3860e-7e47-47f8-b12d-32132211c7eb' class='xr-index-data-in' type='checkbox'/><label for='index-88b3860e-7e47-47f8-b12d-32132211c7eb' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([1000, 1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009,
       ...
       1291, 1292, 1293, 1294, 1295, 1296, 1297, 1298, 1299, 1300],
      dtype=&#x27;int64&#x27;, name=&#x27;x&#x27;, length=301))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>y</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-39c591b5-e299-4675-8ae7-ddfafa993344' class='xr-index-data-in' type='checkbox'/><label for='index-39c591b5-e299-4675-8ae7-ddfafa993344' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([1000, 1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009,
       ...
       1291, 1292, 1293, 1294, 1295, 1296, 1297, 1298, 1299, 1300],
      dtype=&#x27;int64&#x27;, name=&#x27;y&#x27;, length=301))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-405829c9-839f-4d23-8807-e041ab844d4e' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-405829c9-839f-4d23-8807-e041ab844d4e' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># merging the segmentation masks into a single segmentation</span>
<span class="c1"># the threshold value tells you how much of a mask need to overlap for the less important one to be removed</span>
<span class="n">ds_cellpose_merged</span> <span class="o">=</span> <span class="n">ds_cellpose</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">merge_segmentation</span><span class="p">(</span>
    <span class="s2">&quot;_cellpose_segmentation&quot;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Dendritic Cell&quot;</span><span class="p">,</span> <span class="s2">&quot;Macrophage&quot;</span><span class="p">,</span> <span class="s2">&quot;Lymphocyte&quot;</span><span class="p">],</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.8</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_cellpose_merged</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:                 (channels: 3, y: 301, x: 301)
Coordinates:
  * channels                (channels) &lt;U11 &#x27;CD11c&#x27; &#x27;CD68&#x27; &#x27;DAPI&#x27;
  * x                       (x) int64 1000 1001 1002 1003 ... 1298 1299 1300
  * y                       (y) int64 1000 1001 1002 1003 ... 1298 1299 1300
Data variables:
    _image                  (channels, y, x) uint8 dask.array&lt;chunksize=(3, 301, 301), meta=np.ndarray&gt;
    _cellpose_segmentation  (channels, y, x) uint16 0 0 0 0 0 0 ... 320 0 0 0 0
    _merged_segmentation    (y, x) uint16 0 0 0 0 0 25 25 25 ... 0 0 0 0 0 0 0 0</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-a2404757-aeaa-46c1-8ece-98b22ea212cf' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-a2404757-aeaa-46c1-8ece-98b22ea212cf' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>channels</span>: 3</li><li><span class='xr-has-index'>y</span>: 301</li><li><span class='xr-has-index'>x</span>: 301</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-eb72cf33-e15d-4892-80ff-0a82f28d5a34' class='xr-section-summary-in' type='checkbox'  checked><label for='section-eb72cf33-e15d-4892-80ff-0a82f28d5a34' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>channels</span></div><div class='xr-var-dims'>(channels)</div><div class='xr-var-dtype'>&lt;U11</div><div class='xr-var-preview xr-preview'>&#x27;CD11c&#x27; &#x27;CD68&#x27; &#x27;DAPI&#x27;</div><input id='attrs-9048fb87-4e19-4576-aff5-4fa1c4024e3f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9048fb87-4e19-4576-aff5-4fa1c4024e3f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3e719860-8f0f-4ab8-a3cf-c8aebed7c07b' class='xr-var-data-in' type='checkbox'><label for='data-3e719860-8f0f-4ab8-a3cf-c8aebed7c07b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;CD11c&#x27;, &#x27;CD68&#x27;, &#x27;DAPI&#x27;], dtype=&#x27;&lt;U11&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>x</span></div><div class='xr-var-dims'>(x)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1000 1001 1002 ... 1298 1299 1300</div><input id='attrs-5f17cb53-3336-4072-9a72-8f2d0d1d0a62' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-5f17cb53-3336-4072-9a72-8f2d0d1d0a62' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8d86d4eb-e0f2-4940-8b94-e6b3940b6440' class='xr-var-data-in' type='checkbox'><label for='data-8d86d4eb-e0f2-4940-8b94-e6b3940b6440' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1000, 1001, 1002, ..., 1298, 1299, 1300])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>y</span></div><div class='xr-var-dims'>(y)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1000 1001 1002 ... 1298 1299 1300</div><input id='attrs-ff96c591-ab74-4ec3-9eb3-af661696337b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ff96c591-ab74-4ec3-9eb3-af661696337b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-44e8a51e-66f0-4bce-90c9-2ba34fc6a808' class='xr-var-data-in' type='checkbox'><label for='data-44e8a51e-66f0-4bce-90c9-2ba34fc6a808' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1000, 1001, 1002, ..., 1298, 1299, 1300])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-30013d15-b5e6-4cbb-9e09-1a92a4b8565d' class='xr-section-summary-in' type='checkbox'  checked><label for='section-30013d15-b5e6-4cbb-9e09-1a92a4b8565d' class='xr-section-summary' >Data variables: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>_image</span></div><div class='xr-var-dims'>(channels, y, x)</div><div class='xr-var-dtype'>uint8</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(3, 301, 301), meta=np.ndarray&gt;</div><input id='attrs-013bac79-ab34-40f8-8ca7-5494f006c687' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-013bac79-ab34-40f8-8ca7-5494f006c687' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ddd8a36e-834a-45a6-b72a-852605171cf9' class='xr-var-data-in' type='checkbox'><label for='data-ddd8a36e-834a-45a6-b72a-852605171cf9' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>

                    <tr>
                        <th> Bytes </th>
                        <td> 265.43 kiB </td>
                        <td> 265.43 kiB </td>
                    </tr>

                    <tr>
                        <th> Shape </th>
                        <td> (3, 301, 301) </td>
                        <td> (3, 301, 301) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 1 chunks in 4 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> uint8 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="194" height="184" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="24" y2="14" style="stroke-width:2" />
  <line x1="10" y1="120" x2="24" y2="134" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="120" style="stroke-width:2" />
  <line x1="24" y1="14" x2="24" y2="134" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 24.9485979497544,14.948597949754403 24.9485979497544,134.9485979497544 10.0,120.0" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="130" y2="0" style="stroke-width:2" />
  <line x1="24" y1="14" x2="144" y2="14" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="24" y2="14" style="stroke-width:2" />
  <line x1="130" y1="0" x2="144" y2="14" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 130.0,0.0 144.9485979497544,14.948597949754403 24.9485979497544,14.948597949754403" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="24" y1="14" x2="144" y2="14" style="stroke-width:2" />
  <line x1="24" y1="134" x2="144" y2="134" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="24" y1="14" x2="24" y2="134" style="stroke-width:2" />
  <line x1="144" y1="14" x2="144" y2="134" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="24.9485979497544,14.948597949754403 144.9485979497544,14.948597949754403 144.9485979497544,134.9485979497544 24.9485979497544,134.9485979497544" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="84.948598" y="154.948598" font-size="1.0rem" font-weight="100" text-anchor="middle" >301</text>
  <text x="164.948598" y="74.948598" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,164.948598,74.948598)">301</text>
  <text x="7.474299" y="147.474299" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,7.474299,147.474299)">3</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>_cellpose_segmentation</span></div><div class='xr-var-dims'>(channels, y, x)</div><div class='xr-var-dtype'>uint16</div><div class='xr-var-preview xr-preview'>0 0 0 0 0 0 0 ... 320 320 0 0 0 0</div><input id='attrs-6ea0cadb-9d0d-4f65-a356-4fdd2daea79b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-6ea0cadb-9d0d-4f65-a356-4fdd2daea79b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f43868c2-5db5-4362-a9a1-6f9f94c44136' class='xr-var-data-in' type='checkbox'><label for='data-f43868c2-5db5-4362-a9a1-6f9f94c44136' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0],
        ...,
        [  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0]],

       [[  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0],
        ...,
        [  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0]],

       [[  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,  13,  13],
        [  0,   0,   0, ...,   0,  13,  13],
        ...,
        [322, 322, 322, ...,   0,   0,   0],
        [322, 322, 322, ...,   0,   0,   0],
        [322, 322, 322, ...,   0,   0,   0]]], dtype=uint16)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>_merged_segmentation</span></div><div class='xr-var-dims'>(y, x)</div><div class='xr-var-dtype'>uint16</div><div class='xr-var-preview xr-preview'>0 0 0 0 0 25 25 ... 0 0 0 0 0 0 0</div><input id='attrs-bce7842c-aadc-4bd1-a660-0c36e85d4e64' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-bce7842c-aadc-4bd1-a660-0c36e85d4e64' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6564e4f4-0778-4d46-a42c-3615d1c686d5' class='xr-var-data-in' type='checkbox'><label for='data-6564e4f4-0778-4d46-a42c-3615d1c686d5' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>1 :</span></dt><dd>Dendritic Cell</dd><dt><span>2 :</span></dt><dd>Dendritic Cell</dd><dt><span>3 :</span></dt><dd>Dendritic Cell</dd><dt><span>4 :</span></dt><dd>Dendritic Cell</dd><dt><span>5 :</span></dt><dd>Dendritic Cell</dd><dt><span>6 :</span></dt><dd>Dendritic Cell</dd><dt><span>7 :</span></dt><dd>Dendritic Cell</dd><dt><span>8 :</span></dt><dd>Dendritic Cell</dd><dt><span>9 :</span></dt><dd>Dendritic Cell</dd><dt><span>10 :</span></dt><dd>Dendritic Cell</dd><dt><span>11 :</span></dt><dd>Dendritic Cell</dd><dt><span>12 :</span></dt><dd>Dendritic Cell</dd><dt><span>13 :</span></dt><dd>Dendritic Cell</dd><dt><span>14 :</span></dt><dd>Dendritic Cell</dd><dt><span>15 :</span></dt><dd>Dendritic Cell</dd><dt><span>16 :</span></dt><dd>Macrophage</dd><dt><span>17 :</span></dt><dd>Macrophage</dd><dt><span>18 :</span></dt><dd>Macrophage</dd><dt><span>19 :</span></dt><dd>Macrophage</dd><dt><span>20 :</span></dt><dd>Macrophage</dd><dt><span>21 :</span></dt><dd>Macrophage</dd><dt><span>22 :</span></dt><dd>Macrophage</dd><dt><span>23 :</span></dt><dd>Macrophage</dd><dt><span>24 :</span></dt><dd>Macrophage</dd><dt><span>25 :</span></dt><dd>Lymphocyte</dd><dt><span>26 :</span></dt><dd>Lymphocyte</dd><dt><span>27 :</span></dt><dd>Lymphocyte</dd><dt><span>28 :</span></dt><dd>Lymphocyte</dd><dt><span>29 :</span></dt><dd>Lymphocyte</dd><dt><span>30 :</span></dt><dd>Lymphocyte</dd><dt><span>31 :</span></dt><dd>Lymphocyte</dd><dt><span>32 :</span></dt><dd>Lymphocyte</dd><dt><span>33 :</span></dt><dd>Lymphocyte</dd><dt><span>34 :</span></dt><dd>Lymphocyte</dd><dt><span>35 :</span></dt><dd>Lymphocyte</dd><dt><span>36 :</span></dt><dd>Lymphocyte</dd><dt><span>37 :</span></dt><dd>Lymphocyte</dd><dt><span>38 :</span></dt><dd>Lymphocyte</dd><dt><span>39 :</span></dt><dd>Lymphocyte</dd><dt><span>40 :</span></dt><dd>Lymphocyte</dd><dt><span>41 :</span></dt><dd>Lymphocyte</dd><dt><span>42 :</span></dt><dd>Lymphocyte</dd><dt><span>43 :</span></dt><dd>Lymphocyte</dd><dt><span>44 :</span></dt><dd>Lymphocyte</dd><dt><span>45 :</span></dt><dd>Lymphocyte</dd><dt><span>46 :</span></dt><dd>Lymphocyte</dd><dt><span>47 :</span></dt><dd>Lymphocyte</dd><dt><span>48 :</span></dt><dd>Lymphocyte</dd><dt><span>49 :</span></dt><dd>Lymphocyte</dd><dt><span>50 :</span></dt><dd>Lymphocyte</dd><dt><span>51 :</span></dt><dd>Lymphocyte</dd><dt><span>52 :</span></dt><dd>Lymphocyte</dd><dt><span>53 :</span></dt><dd>Lymphocyte</dd><dt><span>54 :</span></dt><dd>Lymphocyte</dd><dt><span>55 :</span></dt><dd>Lymphocyte</dd><dt><span>56 :</span></dt><dd>Lymphocyte</dd><dt><span>57 :</span></dt><dd>Lymphocyte</dd><dt><span>58 :</span></dt><dd>Lymphocyte</dd><dt><span>59 :</span></dt><dd>Lymphocyte</dd><dt><span>60 :</span></dt><dd>Lymphocyte</dd><dt><span>61 :</span></dt><dd>Lymphocyte</dd><dt><span>62 :</span></dt><dd>Lymphocyte</dd><dt><span>63 :</span></dt><dd>Lymphocyte</dd><dt><span>64 :</span></dt><dd>Lymphocyte</dd><dt><span>65 :</span></dt><dd>Lymphocyte</dd><dt><span>66 :</span></dt><dd>Lymphocyte</dd><dt><span>67 :</span></dt><dd>Lymphocyte</dd><dt><span>68 :</span></dt><dd>Lymphocyte</dd><dt><span>69 :</span></dt><dd>Lymphocyte</dd><dt><span>70 :</span></dt><dd>Lymphocyte</dd><dt><span>71 :</span></dt><dd>Lymphocyte</dd><dt><span>72 :</span></dt><dd>Lymphocyte</dd><dt><span>73 :</span></dt><dd>Lymphocyte</dd><dt><span>74 :</span></dt><dd>Lymphocyte</dd><dt><span>75 :</span></dt><dd>Lymphocyte</dd><dt><span>76 :</span></dt><dd>Lymphocyte</dd><dt><span>77 :</span></dt><dd>Lymphocyte</dd><dt><span>78 :</span></dt><dd>Lymphocyte</dd><dt><span>79 :</span></dt><dd>Lymphocyte</dd><dt><span>80 :</span></dt><dd>Lymphocyte</dd><dt><span>81 :</span></dt><dd>Lymphocyte</dd><dt><span>82 :</span></dt><dd>Lymphocyte</dd><dt><span>83 :</span></dt><dd>Lymphocyte</dd><dt><span>84 :</span></dt><dd>Lymphocyte</dd><dt><span>85 :</span></dt><dd>Lymphocyte</dd><dt><span>86 :</span></dt><dd>Lymphocyte</dd><dt><span>87 :</span></dt><dd>Lymphocyte</dd><dt><span>88 :</span></dt><dd>Lymphocyte</dd><dt><span>89 :</span></dt><dd>Lymphocyte</dd><dt><span>90 :</span></dt><dd>Lymphocyte</dd><dt><span>91 :</span></dt><dd>Lymphocyte</dd><dt><span>92 :</span></dt><dd>Lymphocyte</dd><dt><span>93 :</span></dt><dd>Lymphocyte</dd><dt><span>94 :</span></dt><dd>Lymphocyte</dd><dt><span>95 :</span></dt><dd>Lymphocyte</dd><dt><span>96 :</span></dt><dd>Lymphocyte</dd><dt><span>97 :</span></dt><dd>Lymphocyte</dd><dt><span>98 :</span></dt><dd>Lymphocyte</dd><dt><span>99 :</span></dt><dd>Lymphocyte</dd><dt><span>100 :</span></dt><dd>Lymphocyte</dd><dt><span>101 :</span></dt><dd>Lymphocyte</dd><dt><span>102 :</span></dt><dd>Lymphocyte</dd><dt><span>103 :</span></dt><dd>Lymphocyte</dd><dt><span>104 :</span></dt><dd>Lymphocyte</dd><dt><span>105 :</span></dt><dd>Lymphocyte</dd><dt><span>106 :</span></dt><dd>Lymphocyte</dd><dt><span>107 :</span></dt><dd>Lymphocyte</dd><dt><span>108 :</span></dt><dd>Lymphocyte</dd><dt><span>109 :</span></dt><dd>Lymphocyte</dd><dt><span>110 :</span></dt><dd>Lymphocyte</dd><dt><span>111 :</span></dt><dd>Lymphocyte</dd><dt><span>112 :</span></dt><dd>Lymphocyte</dd><dt><span>113 :</span></dt><dd>Lymphocyte</dd><dt><span>114 :</span></dt><dd>Lymphocyte</dd><dt><span>115 :</span></dt><dd>Lymphocyte</dd><dt><span>116 :</span></dt><dd>Lymphocyte</dd><dt><span>117 :</span></dt><dd>Lymphocyte</dd><dt><span>118 :</span></dt><dd>Lymphocyte</dd><dt><span>119 :</span></dt><dd>Lymphocyte</dd><dt><span>120 :</span></dt><dd>Lymphocyte</dd><dt><span>121 :</span></dt><dd>Lymphocyte</dd><dt><span>122 :</span></dt><dd>Lymphocyte</dd><dt><span>123 :</span></dt><dd>Lymphocyte</dd><dt><span>124 :</span></dt><dd>Lymphocyte</dd><dt><span>125 :</span></dt><dd>Lymphocyte</dd><dt><span>126 :</span></dt><dd>Lymphocyte</dd><dt><span>127 :</span></dt><dd>Lymphocyte</dd><dt><span>128 :</span></dt><dd>Lymphocyte</dd><dt><span>129 :</span></dt><dd>Lymphocyte</dd><dt><span>130 :</span></dt><dd>Lymphocyte</dd><dt><span>131 :</span></dt><dd>Lymphocyte</dd><dt><span>132 :</span></dt><dd>Lymphocyte</dd><dt><span>133 :</span></dt><dd>Lymphocyte</dd><dt><span>134 :</span></dt><dd>Lymphocyte</dd><dt><span>135 :</span></dt><dd>Lymphocyte</dd><dt><span>136 :</span></dt><dd>Lymphocyte</dd><dt><span>137 :</span></dt><dd>Lymphocyte</dd><dt><span>138 :</span></dt><dd>Lymphocyte</dd><dt><span>139 :</span></dt><dd>Lymphocyte</dd><dt><span>140 :</span></dt><dd>Lymphocyte</dd><dt><span>141 :</span></dt><dd>Lymphocyte</dd><dt><span>142 :</span></dt><dd>Lymphocyte</dd><dt><span>143 :</span></dt><dd>Lymphocyte</dd><dt><span>144 :</span></dt><dd>Lymphocyte</dd><dt><span>145 :</span></dt><dd>Lymphocyte</dd><dt><span>146 :</span></dt><dd>Lymphocyte</dd><dt><span>147 :</span></dt><dd>Lymphocyte</dd><dt><span>148 :</span></dt><dd>Lymphocyte</dd><dt><span>149 :</span></dt><dd>Lymphocyte</dd><dt><span>150 :</span></dt><dd>Lymphocyte</dd><dt><span>151 :</span></dt><dd>Lymphocyte</dd><dt><span>152 :</span></dt><dd>Lymphocyte</dd><dt><span>153 :</span></dt><dd>Lymphocyte</dd><dt><span>154 :</span></dt><dd>Lymphocyte</dd><dt><span>155 :</span></dt><dd>Lymphocyte</dd><dt><span>156 :</span></dt><dd>Lymphocyte</dd><dt><span>157 :</span></dt><dd>Lymphocyte</dd><dt><span>158 :</span></dt><dd>Lymphocyte</dd><dt><span>159 :</span></dt><dd>Lymphocyte</dd><dt><span>160 :</span></dt><dd>Lymphocyte</dd><dt><span>161 :</span></dt><dd>Lymphocyte</dd><dt><span>162 :</span></dt><dd>Lymphocyte</dd><dt><span>163 :</span></dt><dd>Lymphocyte</dd><dt><span>164 :</span></dt><dd>Lymphocyte</dd><dt><span>165 :</span></dt><dd>Lymphocyte</dd><dt><span>166 :</span></dt><dd>Lymphocyte</dd><dt><span>167 :</span></dt><dd>Lymphocyte</dd><dt><span>168 :</span></dt><dd>Lymphocyte</dd><dt><span>169 :</span></dt><dd>Lymphocyte</dd><dt><span>170 :</span></dt><dd>Lymphocyte</dd><dt><span>171 :</span></dt><dd>Lymphocyte</dd><dt><span>172 :</span></dt><dd>Lymphocyte</dd><dt><span>173 :</span></dt><dd>Lymphocyte</dd><dt><span>174 :</span></dt><dd>Lymphocyte</dd><dt><span>175 :</span></dt><dd>Lymphocyte</dd><dt><span>176 :</span></dt><dd>Lymphocyte</dd><dt><span>177 :</span></dt><dd>Lymphocyte</dd><dt><span>178 :</span></dt><dd>Lymphocyte</dd><dt><span>179 :</span></dt><dd>Lymphocyte</dd><dt><span>180 :</span></dt><dd>Lymphocyte</dd><dt><span>181 :</span></dt><dd>Lymphocyte</dd><dt><span>182 :</span></dt><dd>Lymphocyte</dd><dt><span>183 :</span></dt><dd>Lymphocyte</dd><dt><span>184 :</span></dt><dd>Lymphocyte</dd><dt><span>185 :</span></dt><dd>Lymphocyte</dd><dt><span>186 :</span></dt><dd>Lymphocyte</dd><dt><span>187 :</span></dt><dd>Lymphocyte</dd><dt><span>188 :</span></dt><dd>Lymphocyte</dd><dt><span>189 :</span></dt><dd>Lymphocyte</dd><dt><span>190 :</span></dt><dd>Lymphocyte</dd><dt><span>191 :</span></dt><dd>Lymphocyte</dd><dt><span>192 :</span></dt><dd>Lymphocyte</dd><dt><span>193 :</span></dt><dd>Lymphocyte</dd><dt><span>194 :</span></dt><dd>Lymphocyte</dd><dt><span>195 :</span></dt><dd>Lymphocyte</dd><dt><span>196 :</span></dt><dd>Lymphocyte</dd><dt><span>197 :</span></dt><dd>Lymphocyte</dd><dt><span>198 :</span></dt><dd>Lymphocyte</dd><dt><span>199 :</span></dt><dd>Lymphocyte</dd><dt><span>200 :</span></dt><dd>Lymphocyte</dd><dt><span>201 :</span></dt><dd>Lymphocyte</dd><dt><span>202 :</span></dt><dd>Lymphocyte</dd><dt><span>203 :</span></dt><dd>Lymphocyte</dd><dt><span>204 :</span></dt><dd>Lymphocyte</dd><dt><span>205 :</span></dt><dd>Lymphocyte</dd><dt><span>206 :</span></dt><dd>Lymphocyte</dd><dt><span>207 :</span></dt><dd>Lymphocyte</dd><dt><span>208 :</span></dt><dd>Lymphocyte</dd><dt><span>209 :</span></dt><dd>Lymphocyte</dd><dt><span>210 :</span></dt><dd>Lymphocyte</dd><dt><span>211 :</span></dt><dd>Lymphocyte</dd><dt><span>212 :</span></dt><dd>Lymphocyte</dd><dt><span>213 :</span></dt><dd>Lymphocyte</dd><dt><span>214 :</span></dt><dd>Lymphocyte</dd><dt><span>215 :</span></dt><dd>Lymphocyte</dd><dt><span>216 :</span></dt><dd>Lymphocyte</dd><dt><span>217 :</span></dt><dd>Lymphocyte</dd><dt><span>218 :</span></dt><dd>Lymphocyte</dd><dt><span>219 :</span></dt><dd>Lymphocyte</dd><dt><span>220 :</span></dt><dd>Lymphocyte</dd><dt><span>221 :</span></dt><dd>Lymphocyte</dd><dt><span>222 :</span></dt><dd>Lymphocyte</dd><dt><span>223 :</span></dt><dd>Lymphocyte</dd><dt><span>224 :</span></dt><dd>Lymphocyte</dd><dt><span>225 :</span></dt><dd>Lymphocyte</dd><dt><span>226 :</span></dt><dd>Lymphocyte</dd><dt><span>227 :</span></dt><dd>Lymphocyte</dd><dt><span>228 :</span></dt><dd>Lymphocyte</dd><dt><span>229 :</span></dt><dd>Lymphocyte</dd><dt><span>230 :</span></dt><dd>Lymphocyte</dd><dt><span>231 :</span></dt><dd>Lymphocyte</dd><dt><span>232 :</span></dt><dd>Lymphocyte</dd><dt><span>233 :</span></dt><dd>Lymphocyte</dd><dt><span>234 :</span></dt><dd>Lymphocyte</dd><dt><span>235 :</span></dt><dd>Lymphocyte</dd><dt><span>236 :</span></dt><dd>Lymphocyte</dd><dt><span>237 :</span></dt><dd>Lymphocyte</dd><dt><span>238 :</span></dt><dd>Lymphocyte</dd><dt><span>239 :</span></dt><dd>Lymphocyte</dd><dt><span>240 :</span></dt><dd>Lymphocyte</dd><dt><span>241 :</span></dt><dd>Lymphocyte</dd><dt><span>242 :</span></dt><dd>Lymphocyte</dd><dt><span>243 :</span></dt><dd>Lymphocyte</dd><dt><span>244 :</span></dt><dd>Lymphocyte</dd><dt><span>245 :</span></dt><dd>Lymphocyte</dd><dt><span>246 :</span></dt><dd>Lymphocyte</dd><dt><span>247 :</span></dt><dd>Lymphocyte</dd><dt><span>248 :</span></dt><dd>Lymphocyte</dd><dt><span>249 :</span></dt><dd>Lymphocyte</dd><dt><span>250 :</span></dt><dd>Lymphocyte</dd><dt><span>251 :</span></dt><dd>Lymphocyte</dd><dt><span>252 :</span></dt><dd>Lymphocyte</dd><dt><span>253 :</span></dt><dd>Lymphocyte</dd><dt><span>254 :</span></dt><dd>Lymphocyte</dd><dt><span>255 :</span></dt><dd>Lymphocyte</dd><dt><span>256 :</span></dt><dd>Lymphocyte</dd><dt><span>257 :</span></dt><dd>Lymphocyte</dd><dt><span>258 :</span></dt><dd>Lymphocyte</dd><dt><span>259 :</span></dt><dd>Lymphocyte</dd><dt><span>260 :</span></dt><dd>Lymphocyte</dd><dt><span>261 :</span></dt><dd>Lymphocyte</dd><dt><span>262 :</span></dt><dd>Lymphocyte</dd><dt><span>263 :</span></dt><dd>Lymphocyte</dd><dt><span>264 :</span></dt><dd>Lymphocyte</dd><dt><span>265 :</span></dt><dd>Lymphocyte</dd><dt><span>266 :</span></dt><dd>Lymphocyte</dd><dt><span>267 :</span></dt><dd>Lymphocyte</dd><dt><span>268 :</span></dt><dd>Lymphocyte</dd><dt><span>269 :</span></dt><dd>Lymphocyte</dd><dt><span>270 :</span></dt><dd>Lymphocyte</dd><dt><span>271 :</span></dt><dd>Lymphocyte</dd><dt><span>272 :</span></dt><dd>Lymphocyte</dd><dt><span>273 :</span></dt><dd>Lymphocyte</dd><dt><span>274 :</span></dt><dd>Lymphocyte</dd><dt><span>275 :</span></dt><dd>Lymphocyte</dd><dt><span>276 :</span></dt><dd>Lymphocyte</dd><dt><span>277 :</span></dt><dd>Lymphocyte</dd><dt><span>278 :</span></dt><dd>Lymphocyte</dd><dt><span>279 :</span></dt><dd>Lymphocyte</dd><dt><span>280 :</span></dt><dd>Lymphocyte</dd><dt><span>281 :</span></dt><dd>Lymphocyte</dd><dt><span>282 :</span></dt><dd>Lymphocyte</dd><dt><span>283 :</span></dt><dd>Lymphocyte</dd><dt><span>284 :</span></dt><dd>Lymphocyte</dd><dt><span>285 :</span></dt><dd>Lymphocyte</dd><dt><span>286 :</span></dt><dd>Lymphocyte</dd><dt><span>287 :</span></dt><dd>Lymphocyte</dd><dt><span>288 :</span></dt><dd>Lymphocyte</dd><dt><span>289 :</span></dt><dd>Lymphocyte</dd><dt><span>290 :</span></dt><dd>Lymphocyte</dd><dt><span>291 :</span></dt><dd>Lymphocyte</dd><dt><span>292 :</span></dt><dd>Lymphocyte</dd><dt><span>293 :</span></dt><dd>Lymphocyte</dd><dt><span>294 :</span></dt><dd>Lymphocyte</dd><dt><span>295 :</span></dt><dd>Lymphocyte</dd><dt><span>296 :</span></dt><dd>Lymphocyte</dd></dl></div><div class='xr-var-data'><pre>array([[  0,   0,   0, ...,   0,   0,   0],
       [  0,   0,   0, ...,   0,  37,  37],
       [  0,   0,   0, ...,   0,  37,  37],
       ...,
       [296, 296, 296, ...,   0,   0,   0],
       [296, 296, 296, ...,   0,   0,   0],
       [296, 296, 296, ...,   0,   0,   0]], dtype=uint16)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-babe3913-eb7f-49e4-97db-00429eab3891' class='xr-section-summary-in' type='checkbox'  ><label for='section-babe3913-eb7f-49e4-97db-00429eab3891' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>channels</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-cd28b8d7-980b-46e6-a25e-f63be3eb8c1e' class='xr-index-data-in' type='checkbox'/><label for='index-cd28b8d7-980b-46e6-a25e-f63be3eb8c1e' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;CD11c&#x27;, &#x27;CD68&#x27;, &#x27;DAPI&#x27;], dtype=&#x27;object&#x27;, name=&#x27;channels&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>x</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-bcd64cbe-35a3-4a53-ab21-a641e178092d' class='xr-index-data-in' type='checkbox'/><label for='index-bcd64cbe-35a3-4a53-ab21-a641e178092d' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([1000, 1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009,
       ...
       1291, 1292, 1293, 1294, 1295, 1296, 1297, 1298, 1299, 1300],
      dtype=&#x27;int64&#x27;, name=&#x27;x&#x27;, length=301))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>y</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-ac35f812-fac6-489d-a1ee-7d6fc7d73417' class='xr-index-data-in' type='checkbox'/><label for='index-ac35f812-fac6-489d-a1ee-7d6fc7d73417' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([1000, 1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009,
       ...
       1291, 1292, 1293, 1294, 1295, 1296, 1297, 1298, 1299, 1300],
      dtype=&#x27;int64&#x27;, name=&#x27;y&#x27;, length=301))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-bec8572f-48f0-42aa-91ee-f979f1e24edf' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-bec8572f-48f0-42aa-91ee-f979f1e24edf' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># adding the merged segmentation as the main segmentation in the object</span>
<span class="c1"># this is done so that we can visualize the result with pl.show(render_segmentation=True), without needing to specify which segmentation we want to show</span>
<span class="n">ds_cellpose_merged</span> <span class="o">=</span> <span class="n">ds_cellpose_merged</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">add_segmentation</span><span class="p">(</span><span class="s2">&quot;_merged_segmentation&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_cellpose_merged</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:                 (labels: 3, la_props: 2, channels: 3, x: 301,
                             y: 301, cells: 296, features: 3)
Coordinates:
  * labels                  (labels) int64 1 2 3
  * la_props                (la_props) &lt;U6 &#x27;_color&#x27; &#x27;_name&#x27;
  * channels                (channels) &lt;U11 &#x27;CD11c&#x27; &#x27;CD68&#x27; &#x27;DAPI&#x27;
  * x                       (x) int64 1000 1001 1002 1003 ... 1298 1299 1300
  * y                       (y) int64 1000 1001 1002 1003 ... 1298 1299 1300
  * cells                   (cells) int64 1 2 3 4 5 6 ... 292 293 294 295 296
  * features                (features) &lt;U10 &#x27;_labels&#x27; &#x27;centroid-0&#x27; &#x27;centroid-1&#x27;
Data variables:
    _la_properties          (labels, la_props) object &#x27;#C8A1A1&#x27; ... &#x27;Macrophage&#x27;
    _image                  (channels, y, x) uint8 dask.array&lt;chunksize=(3, 301, 301), meta=np.ndarray&gt;
    _cellpose_segmentation  (channels, y, x) uint16 0 0 0 0 0 0 ... 320 0 0 0 0
    _merged_segmentation    (y, x) uint16 0 0 0 0 0 25 25 25 ... 0 0 0 0 0 0 0 0
    _obs                    (cells, features) float64 1.0 1.04e+03 ... 1.003e+03
    _segmentation           (y, x) uint16 0 0 0 0 0 25 25 25 ... 0 0 0 0 0 0 0 0</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-c3460916-0dde-4bdf-9b9f-eb8e4bef0413' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-c3460916-0dde-4bdf-9b9f-eb8e4bef0413' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>labels</span>: 3</li><li><span class='xr-has-index'>la_props</span>: 2</li><li><span class='xr-has-index'>channels</span>: 3</li><li><span class='xr-has-index'>x</span>: 301</li><li><span class='xr-has-index'>y</span>: 301</li><li><span class='xr-has-index'>cells</span>: 296</li><li><span class='xr-has-index'>features</span>: 3</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-b44730d1-89dd-4e3c-bce4-6e776039200a' class='xr-section-summary-in' type='checkbox'  checked><label for='section-b44730d1-89dd-4e3c-bce4-6e776039200a' class='xr-section-summary' >Coordinates: <span>(7)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>labels</span></div><div class='xr-var-dims'>(labels)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 2 3</div><input id='attrs-987ad427-198a-47d8-8d6f-3b2057d2bccf' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-987ad427-198a-47d8-8d6f-3b2057d2bccf' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3561634d-a0a4-462a-b43d-472ae9bce538' class='xr-var-data-in' type='checkbox'><label for='data-3561634d-a0a4-462a-b43d-472ae9bce538' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1, 2, 3])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>la_props</span></div><div class='xr-var-dims'>(la_props)</div><div class='xr-var-dtype'>&lt;U6</div><div class='xr-var-preview xr-preview'>&#x27;_color&#x27; &#x27;_name&#x27;</div><input id='attrs-24974ed6-32d4-4700-b8ab-b3e0c733a3cc' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-24974ed6-32d4-4700-b8ab-b3e0c733a3cc' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ee2b5f77-4fa6-4051-9ab9-3bee2eb918ae' class='xr-var-data-in' type='checkbox'><label for='data-ee2b5f77-4fa6-4051-9ab9-3bee2eb918ae' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;_color&#x27;, &#x27;_name&#x27;], dtype=&#x27;&lt;U6&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>channels</span></div><div class='xr-var-dims'>(channels)</div><div class='xr-var-dtype'>&lt;U11</div><div class='xr-var-preview xr-preview'>&#x27;CD11c&#x27; &#x27;CD68&#x27; &#x27;DAPI&#x27;</div><input id='attrs-e65384d2-e429-4793-bbad-222cabfd520d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e65384d2-e429-4793-bbad-222cabfd520d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8ca1861a-2e53-4fd3-b451-629658b5cb40' class='xr-var-data-in' type='checkbox'><label for='data-8ca1861a-2e53-4fd3-b451-629658b5cb40' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;CD11c&#x27;, &#x27;CD68&#x27;, &#x27;DAPI&#x27;], dtype=&#x27;&lt;U11&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>x</span></div><div class='xr-var-dims'>(x)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1000 1001 1002 ... 1298 1299 1300</div><input id='attrs-e1ba7588-4c40-4112-a5f1-99a60517207b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e1ba7588-4c40-4112-a5f1-99a60517207b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-cb5a667c-0537-4f16-a8df-81281c3ac22a' class='xr-var-data-in' type='checkbox'><label for='data-cb5a667c-0537-4f16-a8df-81281c3ac22a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1000, 1001, 1002, ..., 1298, 1299, 1300])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>y</span></div><div class='xr-var-dims'>(y)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1000 1001 1002 ... 1298 1299 1300</div><input id='attrs-628a70bd-fe40-4a04-b5ad-6cac5dabbd8f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-628a70bd-fe40-4a04-b5ad-6cac5dabbd8f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-41f026a4-b9c0-45d6-a5de-d207d0366dca' class='xr-var-data-in' type='checkbox'><label for='data-41f026a4-b9c0-45d6-a5de-d207d0366dca' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1000, 1001, 1002, ..., 1298, 1299, 1300])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>cells</span></div><div class='xr-var-dims'>(cells)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 2 3 4 5 6 ... 292 293 294 295 296</div><input id='attrs-e64ab226-40a1-49b8-ad3d-86c44dfedd56' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e64ab226-40a1-49b8-ad3d-86c44dfedd56' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-10e46ceb-a3ba-46c4-b63b-ccbcedce1887' class='xr-var-data-in' type='checkbox'><label for='data-10e46ceb-a3ba-46c4-b63b-ccbcedce1887' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([  1,   2,   3, ..., 294, 295, 296])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>features</span></div><div class='xr-var-dims'>(features)</div><div class='xr-var-dtype'>&lt;U10</div><div class='xr-var-preview xr-preview'>&#x27;_labels&#x27; &#x27;centroid-0&#x27; &#x27;centroid-1&#x27;</div><input id='attrs-26abbdc3-e4cf-4ffa-95cd-10811905c780' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-26abbdc3-e4cf-4ffa-95cd-10811905c780' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8a7f895d-88c8-418b-a7c6-cd054a5a943a' class='xr-var-data-in' type='checkbox'><label for='data-8a7f895d-88c8-418b-a7c6-cd054a5a943a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;_labels&#x27;, &#x27;centroid-0&#x27;, &#x27;centroid-1&#x27;], dtype=&#x27;&lt;U10&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-fec24bf7-e2ba-4002-82f3-a4e11e6a182c' class='xr-section-summary-in' type='checkbox'  checked><label for='section-fec24bf7-e2ba-4002-82f3-a4e11e6a182c' class='xr-section-summary' >Data variables: <span>(6)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>_la_properties</span></div><div class='xr-var-dims'>(labels, la_props)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;#C8A1A1&#x27; ... &#x27;Macrophage&#x27;</div><input id='attrs-0427ba00-76ad-411d-a671-65a54d50aa26' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-0427ba00-76ad-411d-a671-65a54d50aa26' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-295ae60e-acd3-4cf5-aba7-0b2444851ed3' class='xr-var-data-in' type='checkbox'><label for='data-295ae60e-acd3-4cf5-aba7-0b2444851ed3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[&#x27;#C8A1A1&#x27;, &#x27;Dendritic Cell&#x27;],
       [&#x27;#549E79&#x27;, &#x27;Lymphocyte&#x27;],
       [&#x27;#000035&#x27;, &#x27;Macrophage&#x27;]], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>_image</span></div><div class='xr-var-dims'>(channels, y, x)</div><div class='xr-var-dtype'>uint8</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(3, 301, 301), meta=np.ndarray&gt;</div><input id='attrs-29dd399c-7da8-40f1-bf95-81dee8197cf3' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-29dd399c-7da8-40f1-bf95-81dee8197cf3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-30514c0e-3fbf-4b09-9b9b-393722c993e2' class='xr-var-data-in' type='checkbox'><label for='data-30514c0e-3fbf-4b09-9b9b-393722c993e2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>

                    <tr>
                        <th> Bytes </th>
                        <td> 265.43 kiB </td>
                        <td> 265.43 kiB </td>
                    </tr>

                    <tr>
                        <th> Shape </th>
                        <td> (3, 301, 301) </td>
                        <td> (3, 301, 301) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 1 chunks in 4 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> uint8 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="194" height="184" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="24" y2="14" style="stroke-width:2" />
  <line x1="10" y1="120" x2="24" y2="134" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="120" style="stroke-width:2" />
  <line x1="24" y1="14" x2="24" y2="134" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 24.9485979497544,14.948597949754403 24.9485979497544,134.9485979497544 10.0,120.0" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="130" y2="0" style="stroke-width:2" />
  <line x1="24" y1="14" x2="144" y2="14" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="24" y2="14" style="stroke-width:2" />
  <line x1="130" y1="0" x2="144" y2="14" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 130.0,0.0 144.9485979497544,14.948597949754403 24.9485979497544,14.948597949754403" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="24" y1="14" x2="144" y2="14" style="stroke-width:2" />
  <line x1="24" y1="134" x2="144" y2="134" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="24" y1="14" x2="24" y2="134" style="stroke-width:2" />
  <line x1="144" y1="14" x2="144" y2="134" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="24.9485979497544,14.948597949754403 144.9485979497544,14.948597949754403 144.9485979497544,134.9485979497544 24.9485979497544,134.9485979497544" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="84.948598" y="154.948598" font-size="1.0rem" font-weight="100" text-anchor="middle" >301</text>
  <text x="164.948598" y="74.948598" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,164.948598,74.948598)">301</text>
  <text x="7.474299" y="147.474299" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,7.474299,147.474299)">3</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>_cellpose_segmentation</span></div><div class='xr-var-dims'>(channels, y, x)</div><div class='xr-var-dtype'>uint16</div><div class='xr-var-preview xr-preview'>0 0 0 0 0 0 0 ... 320 320 0 0 0 0</div><input id='attrs-59e621a1-7077-4580-b112-80d0ffd7f035' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-59e621a1-7077-4580-b112-80d0ffd7f035' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-601446b8-8ab7-4355-bd3f-9a17494fe4d2' class='xr-var-data-in' type='checkbox'><label for='data-601446b8-8ab7-4355-bd3f-9a17494fe4d2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0],
        ...,
        [  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0]],

       [[  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0],
        ...,
        [  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,   0,   0]],

       [[  0,   0,   0, ...,   0,   0,   0],
        [  0,   0,   0, ...,   0,  13,  13],
        [  0,   0,   0, ...,   0,  13,  13],
        ...,
        [322, 322, 322, ...,   0,   0,   0],
        [322, 322, 322, ...,   0,   0,   0],
        [322, 322, 322, ...,   0,   0,   0]]], dtype=uint16)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>_merged_segmentation</span></div><div class='xr-var-dims'>(y, x)</div><div class='xr-var-dtype'>uint16</div><div class='xr-var-preview xr-preview'>0 0 0 0 0 25 25 ... 0 0 0 0 0 0 0</div><input id='attrs-7455cea9-3354-4f6e-9e5e-ff23c0840ef4' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-7455cea9-3354-4f6e-9e5e-ff23c0840ef4' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4a89da57-75d2-44f3-ab0f-25287d117c4c' class='xr-var-data-in' type='checkbox'><label for='data-4a89da57-75d2-44f3-ab0f-25287d117c4c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>1 :</span></dt><dd>Dendritic Cell</dd><dt><span>2 :</span></dt><dd>Dendritic Cell</dd><dt><span>3 :</span></dt><dd>Dendritic Cell</dd><dt><span>4 :</span></dt><dd>Dendritic Cell</dd><dt><span>5 :</span></dt><dd>Dendritic Cell</dd><dt><span>6 :</span></dt><dd>Dendritic Cell</dd><dt><span>7 :</span></dt><dd>Dendritic Cell</dd><dt><span>8 :</span></dt><dd>Dendritic Cell</dd><dt><span>9 :</span></dt><dd>Dendritic Cell</dd><dt><span>10 :</span></dt><dd>Dendritic Cell</dd><dt><span>11 :</span></dt><dd>Dendritic Cell</dd><dt><span>12 :</span></dt><dd>Dendritic Cell</dd><dt><span>13 :</span></dt><dd>Dendritic Cell</dd><dt><span>14 :</span></dt><dd>Dendritic Cell</dd><dt><span>15 :</span></dt><dd>Dendritic Cell</dd><dt><span>16 :</span></dt><dd>Macrophage</dd><dt><span>17 :</span></dt><dd>Macrophage</dd><dt><span>18 :</span></dt><dd>Macrophage</dd><dt><span>19 :</span></dt><dd>Macrophage</dd><dt><span>20 :</span></dt><dd>Macrophage</dd><dt><span>21 :</span></dt><dd>Macrophage</dd><dt><span>22 :</span></dt><dd>Macrophage</dd><dt><span>23 :</span></dt><dd>Macrophage</dd><dt><span>24 :</span></dt><dd>Macrophage</dd><dt><span>25 :</span></dt><dd>Lymphocyte</dd><dt><span>26 :</span></dt><dd>Lymphocyte</dd><dt><span>27 :</span></dt><dd>Lymphocyte</dd><dt><span>28 :</span></dt><dd>Lymphocyte</dd><dt><span>29 :</span></dt><dd>Lymphocyte</dd><dt><span>30 :</span></dt><dd>Lymphocyte</dd><dt><span>31 :</span></dt><dd>Lymphocyte</dd><dt><span>32 :</span></dt><dd>Lymphocyte</dd><dt><span>33 :</span></dt><dd>Lymphocyte</dd><dt><span>34 :</span></dt><dd>Lymphocyte</dd><dt><span>35 :</span></dt><dd>Lymphocyte</dd><dt><span>36 :</span></dt><dd>Lymphocyte</dd><dt><span>37 :</span></dt><dd>Lymphocyte</dd><dt><span>38 :</span></dt><dd>Lymphocyte</dd><dt><span>39 :</span></dt><dd>Lymphocyte</dd><dt><span>40 :</span></dt><dd>Lymphocyte</dd><dt><span>41 :</span></dt><dd>Lymphocyte</dd><dt><span>42 :</span></dt><dd>Lymphocyte</dd><dt><span>43 :</span></dt><dd>Lymphocyte</dd><dt><span>44 :</span></dt><dd>Lymphocyte</dd><dt><span>45 :</span></dt><dd>Lymphocyte</dd><dt><span>46 :</span></dt><dd>Lymphocyte</dd><dt><span>47 :</span></dt><dd>Lymphocyte</dd><dt><span>48 :</span></dt><dd>Lymphocyte</dd><dt><span>49 :</span></dt><dd>Lymphocyte</dd><dt><span>50 :</span></dt><dd>Lymphocyte</dd><dt><span>51 :</span></dt><dd>Lymphocyte</dd><dt><span>52 :</span></dt><dd>Lymphocyte</dd><dt><span>53 :</span></dt><dd>Lymphocyte</dd><dt><span>54 :</span></dt><dd>Lymphocyte</dd><dt><span>55 :</span></dt><dd>Lymphocyte</dd><dt><span>56 :</span></dt><dd>Lymphocyte</dd><dt><span>57 :</span></dt><dd>Lymphocyte</dd><dt><span>58 :</span></dt><dd>Lymphocyte</dd><dt><span>59 :</span></dt><dd>Lymphocyte</dd><dt><span>60 :</span></dt><dd>Lymphocyte</dd><dt><span>61 :</span></dt><dd>Lymphocyte</dd><dt><span>62 :</span></dt><dd>Lymphocyte</dd><dt><span>63 :</span></dt><dd>Lymphocyte</dd><dt><span>64 :</span></dt><dd>Lymphocyte</dd><dt><span>65 :</span></dt><dd>Lymphocyte</dd><dt><span>66 :</span></dt><dd>Lymphocyte</dd><dt><span>67 :</span></dt><dd>Lymphocyte</dd><dt><span>68 :</span></dt><dd>Lymphocyte</dd><dt><span>69 :</span></dt><dd>Lymphocyte</dd><dt><span>70 :</span></dt><dd>Lymphocyte</dd><dt><span>71 :</span></dt><dd>Lymphocyte</dd><dt><span>72 :</span></dt><dd>Lymphocyte</dd><dt><span>73 :</span></dt><dd>Lymphocyte</dd><dt><span>74 :</span></dt><dd>Lymphocyte</dd><dt><span>75 :</span></dt><dd>Lymphocyte</dd><dt><span>76 :</span></dt><dd>Lymphocyte</dd><dt><span>77 :</span></dt><dd>Lymphocyte</dd><dt><span>78 :</span></dt><dd>Lymphocyte</dd><dt><span>79 :</span></dt><dd>Lymphocyte</dd><dt><span>80 :</span></dt><dd>Lymphocyte</dd><dt><span>81 :</span></dt><dd>Lymphocyte</dd><dt><span>82 :</span></dt><dd>Lymphocyte</dd><dt><span>83 :</span></dt><dd>Lymphocyte</dd><dt><span>84 :</span></dt><dd>Lymphocyte</dd><dt><span>85 :</span></dt><dd>Lymphocyte</dd><dt><span>86 :</span></dt><dd>Lymphocyte</dd><dt><span>87 :</span></dt><dd>Lymphocyte</dd><dt><span>88 :</span></dt><dd>Lymphocyte</dd><dt><span>89 :</span></dt><dd>Lymphocyte</dd><dt><span>90 :</span></dt><dd>Lymphocyte</dd><dt><span>91 :</span></dt><dd>Lymphocyte</dd><dt><span>92 :</span></dt><dd>Lymphocyte</dd><dt><span>93 :</span></dt><dd>Lymphocyte</dd><dt><span>94 :</span></dt><dd>Lymphocyte</dd><dt><span>95 :</span></dt><dd>Lymphocyte</dd><dt><span>96 :</span></dt><dd>Lymphocyte</dd><dt><span>97 :</span></dt><dd>Lymphocyte</dd><dt><span>98 :</span></dt><dd>Lymphocyte</dd><dt><span>99 :</span></dt><dd>Lymphocyte</dd><dt><span>100 :</span></dt><dd>Lymphocyte</dd><dt><span>101 :</span></dt><dd>Lymphocyte</dd><dt><span>102 :</span></dt><dd>Lymphocyte</dd><dt><span>103 :</span></dt><dd>Lymphocyte</dd><dt><span>104 :</span></dt><dd>Lymphocyte</dd><dt><span>105 :</span></dt><dd>Lymphocyte</dd><dt><span>106 :</span></dt><dd>Lymphocyte</dd><dt><span>107 :</span></dt><dd>Lymphocyte</dd><dt><span>108 :</span></dt><dd>Lymphocyte</dd><dt><span>109 :</span></dt><dd>Lymphocyte</dd><dt><span>110 :</span></dt><dd>Lymphocyte</dd><dt><span>111 :</span></dt><dd>Lymphocyte</dd><dt><span>112 :</span></dt><dd>Lymphocyte</dd><dt><span>113 :</span></dt><dd>Lymphocyte</dd><dt><span>114 :</span></dt><dd>Lymphocyte</dd><dt><span>115 :</span></dt><dd>Lymphocyte</dd><dt><span>116 :</span></dt><dd>Lymphocyte</dd><dt><span>117 :</span></dt><dd>Lymphocyte</dd><dt><span>118 :</span></dt><dd>Lymphocyte</dd><dt><span>119 :</span></dt><dd>Lymphocyte</dd><dt><span>120 :</span></dt><dd>Lymphocyte</dd><dt><span>121 :</span></dt><dd>Lymphocyte</dd><dt><span>122 :</span></dt><dd>Lymphocyte</dd><dt><span>123 :</span></dt><dd>Lymphocyte</dd><dt><span>124 :</span></dt><dd>Lymphocyte</dd><dt><span>125 :</span></dt><dd>Lymphocyte</dd><dt><span>126 :</span></dt><dd>Lymphocyte</dd><dt><span>127 :</span></dt><dd>Lymphocyte</dd><dt><span>128 :</span></dt><dd>Lymphocyte</dd><dt><span>129 :</span></dt><dd>Lymphocyte</dd><dt><span>130 :</span></dt><dd>Lymphocyte</dd><dt><span>131 :</span></dt><dd>Lymphocyte</dd><dt><span>132 :</span></dt><dd>Lymphocyte</dd><dt><span>133 :</span></dt><dd>Lymphocyte</dd><dt><span>134 :</span></dt><dd>Lymphocyte</dd><dt><span>135 :</span></dt><dd>Lymphocyte</dd><dt><span>136 :</span></dt><dd>Lymphocyte</dd><dt><span>137 :</span></dt><dd>Lymphocyte</dd><dt><span>138 :</span></dt><dd>Lymphocyte</dd><dt><span>139 :</span></dt><dd>Lymphocyte</dd><dt><span>140 :</span></dt><dd>Lymphocyte</dd><dt><span>141 :</span></dt><dd>Lymphocyte</dd><dt><span>142 :</span></dt><dd>Lymphocyte</dd><dt><span>143 :</span></dt><dd>Lymphocyte</dd><dt><span>144 :</span></dt><dd>Lymphocyte</dd><dt><span>145 :</span></dt><dd>Lymphocyte</dd><dt><span>146 :</span></dt><dd>Lymphocyte</dd><dt><span>147 :</span></dt><dd>Lymphocyte</dd><dt><span>148 :</span></dt><dd>Lymphocyte</dd><dt><span>149 :</span></dt><dd>Lymphocyte</dd><dt><span>150 :</span></dt><dd>Lymphocyte</dd><dt><span>151 :</span></dt><dd>Lymphocyte</dd><dt><span>152 :</span></dt><dd>Lymphocyte</dd><dt><span>153 :</span></dt><dd>Lymphocyte</dd><dt><span>154 :</span></dt><dd>Lymphocyte</dd><dt><span>155 :</span></dt><dd>Lymphocyte</dd><dt><span>156 :</span></dt><dd>Lymphocyte</dd><dt><span>157 :</span></dt><dd>Lymphocyte</dd><dt><span>158 :</span></dt><dd>Lymphocyte</dd><dt><span>159 :</span></dt><dd>Lymphocyte</dd><dt><span>160 :</span></dt><dd>Lymphocyte</dd><dt><span>161 :</span></dt><dd>Lymphocyte</dd><dt><span>162 :</span></dt><dd>Lymphocyte</dd><dt><span>163 :</span></dt><dd>Lymphocyte</dd><dt><span>164 :</span></dt><dd>Lymphocyte</dd><dt><span>165 :</span></dt><dd>Lymphocyte</dd><dt><span>166 :</span></dt><dd>Lymphocyte</dd><dt><span>167 :</span></dt><dd>Lymphocyte</dd><dt><span>168 :</span></dt><dd>Lymphocyte</dd><dt><span>169 :</span></dt><dd>Lymphocyte</dd><dt><span>170 :</span></dt><dd>Lymphocyte</dd><dt><span>171 :</span></dt><dd>Lymphocyte</dd><dt><span>172 :</span></dt><dd>Lymphocyte</dd><dt><span>173 :</span></dt><dd>Lymphocyte</dd><dt><span>174 :</span></dt><dd>Lymphocyte</dd><dt><span>175 :</span></dt><dd>Lymphocyte</dd><dt><span>176 :</span></dt><dd>Lymphocyte</dd><dt><span>177 :</span></dt><dd>Lymphocyte</dd><dt><span>178 :</span></dt><dd>Lymphocyte</dd><dt><span>179 :</span></dt><dd>Lymphocyte</dd><dt><span>180 :</span></dt><dd>Lymphocyte</dd><dt><span>181 :</span></dt><dd>Lymphocyte</dd><dt><span>182 :</span></dt><dd>Lymphocyte</dd><dt><span>183 :</span></dt><dd>Lymphocyte</dd><dt><span>184 :</span></dt><dd>Lymphocyte</dd><dt><span>185 :</span></dt><dd>Lymphocyte</dd><dt><span>186 :</span></dt><dd>Lymphocyte</dd><dt><span>187 :</span></dt><dd>Lymphocyte</dd><dt><span>188 :</span></dt><dd>Lymphocyte</dd><dt><span>189 :</span></dt><dd>Lymphocyte</dd><dt><span>190 :</span></dt><dd>Lymphocyte</dd><dt><span>191 :</span></dt><dd>Lymphocyte</dd><dt><span>192 :</span></dt><dd>Lymphocyte</dd><dt><span>193 :</span></dt><dd>Lymphocyte</dd><dt><span>194 :</span></dt><dd>Lymphocyte</dd><dt><span>195 :</span></dt><dd>Lymphocyte</dd><dt><span>196 :</span></dt><dd>Lymphocyte</dd><dt><span>197 :</span></dt><dd>Lymphocyte</dd><dt><span>198 :</span></dt><dd>Lymphocyte</dd><dt><span>199 :</span></dt><dd>Lymphocyte</dd><dt><span>200 :</span></dt><dd>Lymphocyte</dd><dt><span>201 :</span></dt><dd>Lymphocyte</dd><dt><span>202 :</span></dt><dd>Lymphocyte</dd><dt><span>203 :</span></dt><dd>Lymphocyte</dd><dt><span>204 :</span></dt><dd>Lymphocyte</dd><dt><span>205 :</span></dt><dd>Lymphocyte</dd><dt><span>206 :</span></dt><dd>Lymphocyte</dd><dt><span>207 :</span></dt><dd>Lymphocyte</dd><dt><span>208 :</span></dt><dd>Lymphocyte</dd><dt><span>209 :</span></dt><dd>Lymphocyte</dd><dt><span>210 :</span></dt><dd>Lymphocyte</dd><dt><span>211 :</span></dt><dd>Lymphocyte</dd><dt><span>212 :</span></dt><dd>Lymphocyte</dd><dt><span>213 :</span></dt><dd>Lymphocyte</dd><dt><span>214 :</span></dt><dd>Lymphocyte</dd><dt><span>215 :</span></dt><dd>Lymphocyte</dd><dt><span>216 :</span></dt><dd>Lymphocyte</dd><dt><span>217 :</span></dt><dd>Lymphocyte</dd><dt><span>218 :</span></dt><dd>Lymphocyte</dd><dt><span>219 :</span></dt><dd>Lymphocyte</dd><dt><span>220 :</span></dt><dd>Lymphocyte</dd><dt><span>221 :</span></dt><dd>Lymphocyte</dd><dt><span>222 :</span></dt><dd>Lymphocyte</dd><dt><span>223 :</span></dt><dd>Lymphocyte</dd><dt><span>224 :</span></dt><dd>Lymphocyte</dd><dt><span>225 :</span></dt><dd>Lymphocyte</dd><dt><span>226 :</span></dt><dd>Lymphocyte</dd><dt><span>227 :</span></dt><dd>Lymphocyte</dd><dt><span>228 :</span></dt><dd>Lymphocyte</dd><dt><span>229 :</span></dt><dd>Lymphocyte</dd><dt><span>230 :</span></dt><dd>Lymphocyte</dd><dt><span>231 :</span></dt><dd>Lymphocyte</dd><dt><span>232 :</span></dt><dd>Lymphocyte</dd><dt><span>233 :</span></dt><dd>Lymphocyte</dd><dt><span>234 :</span></dt><dd>Lymphocyte</dd><dt><span>235 :</span></dt><dd>Lymphocyte</dd><dt><span>236 :</span></dt><dd>Lymphocyte</dd><dt><span>237 :</span></dt><dd>Lymphocyte</dd><dt><span>238 :</span></dt><dd>Lymphocyte</dd><dt><span>239 :</span></dt><dd>Lymphocyte</dd><dt><span>240 :</span></dt><dd>Lymphocyte</dd><dt><span>241 :</span></dt><dd>Lymphocyte</dd><dt><span>242 :</span></dt><dd>Lymphocyte</dd><dt><span>243 :</span></dt><dd>Lymphocyte</dd><dt><span>244 :</span></dt><dd>Lymphocyte</dd><dt><span>245 :</span></dt><dd>Lymphocyte</dd><dt><span>246 :</span></dt><dd>Lymphocyte</dd><dt><span>247 :</span></dt><dd>Lymphocyte</dd><dt><span>248 :</span></dt><dd>Lymphocyte</dd><dt><span>249 :</span></dt><dd>Lymphocyte</dd><dt><span>250 :</span></dt><dd>Lymphocyte</dd><dt><span>251 :</span></dt><dd>Lymphocyte</dd><dt><span>252 :</span></dt><dd>Lymphocyte</dd><dt><span>253 :</span></dt><dd>Lymphocyte</dd><dt><span>254 :</span></dt><dd>Lymphocyte</dd><dt><span>255 :</span></dt><dd>Lymphocyte</dd><dt><span>256 :</span></dt><dd>Lymphocyte</dd><dt><span>257 :</span></dt><dd>Lymphocyte</dd><dt><span>258 :</span></dt><dd>Lymphocyte</dd><dt><span>259 :</span></dt><dd>Lymphocyte</dd><dt><span>260 :</span></dt><dd>Lymphocyte</dd><dt><span>261 :</span></dt><dd>Lymphocyte</dd><dt><span>262 :</span></dt><dd>Lymphocyte</dd><dt><span>263 :</span></dt><dd>Lymphocyte</dd><dt><span>264 :</span></dt><dd>Lymphocyte</dd><dt><span>265 :</span></dt><dd>Lymphocyte</dd><dt><span>266 :</span></dt><dd>Lymphocyte</dd><dt><span>267 :</span></dt><dd>Lymphocyte</dd><dt><span>268 :</span></dt><dd>Lymphocyte</dd><dt><span>269 :</span></dt><dd>Lymphocyte</dd><dt><span>270 :</span></dt><dd>Lymphocyte</dd><dt><span>271 :</span></dt><dd>Lymphocyte</dd><dt><span>272 :</span></dt><dd>Lymphocyte</dd><dt><span>273 :</span></dt><dd>Lymphocyte</dd><dt><span>274 :</span></dt><dd>Lymphocyte</dd><dt><span>275 :</span></dt><dd>Lymphocyte</dd><dt><span>276 :</span></dt><dd>Lymphocyte</dd><dt><span>277 :</span></dt><dd>Lymphocyte</dd><dt><span>278 :</span></dt><dd>Lymphocyte</dd><dt><span>279 :</span></dt><dd>Lymphocyte</dd><dt><span>280 :</span></dt><dd>Lymphocyte</dd><dt><span>281 :</span></dt><dd>Lymphocyte</dd><dt><span>282 :</span></dt><dd>Lymphocyte</dd><dt><span>283 :</span></dt><dd>Lymphocyte</dd><dt><span>284 :</span></dt><dd>Lymphocyte</dd><dt><span>285 :</span></dt><dd>Lymphocyte</dd><dt><span>286 :</span></dt><dd>Lymphocyte</dd><dt><span>287 :</span></dt><dd>Lymphocyte</dd><dt><span>288 :</span></dt><dd>Lymphocyte</dd><dt><span>289 :</span></dt><dd>Lymphocyte</dd><dt><span>290 :</span></dt><dd>Lymphocyte</dd><dt><span>291 :</span></dt><dd>Lymphocyte</dd><dt><span>292 :</span></dt><dd>Lymphocyte</dd><dt><span>293 :</span></dt><dd>Lymphocyte</dd><dt><span>294 :</span></dt><dd>Lymphocyte</dd><dt><span>295 :</span></dt><dd>Lymphocyte</dd><dt><span>296 :</span></dt><dd>Lymphocyte</dd></dl></div><div class='xr-var-data'><pre>array([[  0,   0,   0, ...,   0,   0,   0],
       [  0,   0,   0, ...,   0,  37,  37],
       [  0,   0,   0, ...,   0,  37,  37],
       ...,
       [296, 296, 296, ...,   0,   0,   0],
       [296, 296, 296, ...,   0,   0,   0],
       [296, 296, 296, ...,   0,   0,   0]], dtype=uint16)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>_obs</span></div><div class='xr-var-dims'>(cells, features)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>1.0 1.04e+03 ... 1.003e+03</div><input id='attrs-ef55c177-5a2d-46d0-bf83-bb31fd0fb273' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ef55c177-5a2d-46d0-bf83-bb31fd0fb273' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-148d3a2a-f2ce-4cb3-a344-86e05258ebdc' class='xr-var-data-in' type='checkbox'><label for='data-148d3a2a-f2ce-4cb3-a344-86e05258ebdc' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[1.00000000e+00, 1.03976395e+03, 1.01177127e+03],
       [1.00000000e+00, 1.04003425e+03, 1.26775342e+03],
       [1.00000000e+00, 1.05124330e+03, 1.13856696e+03],
       [1.00000000e+00, 1.10571235e+03, 1.12722843e+03],
       [1.00000000e+00, 1.14620124e+03, 1.01776398e+03],
       [1.00000000e+00, 1.16230389e+03, 1.17880722e+03],
       [1.00000000e+00, 1.18058482e+03, 1.01311161e+03],
       [1.00000000e+00, 1.19026624e+03, 1.28613629e+03],
       [1.00000000e+00, 1.20758269e+03, 1.05454001e+03],
       [1.00000000e+00, 1.20234309e+03, 1.21452342e+03],
       [1.00000000e+00, 1.26504545e+03, 1.19021678e+03],
       [1.00000000e+00, 1.28005426e+03, 1.27537234e+03],
       [1.00000000e+00, 1.27334663e+03, 1.13492020e+03],
       [1.00000000e+00, 1.28796612e+03, 1.15875584e+03],
       [1.00000000e+00, 1.29483128e+03, 1.02832099e+03],
       [3.00000000e+00, 1.00864773e+03, 1.10269886e+03],
       [3.00000000e+00, 1.05833333e+03, 1.00033333e+03],
       [3.00000000e+00, 1.05521469e+03, 1.22499435e+03],
       [3.00000000e+00, 1.09622517e+03, 1.11684106e+03],
       [3.00000000e+00, 1.12757364e+03, 1.22200000e+03],
...
       [2.00000000e+00, 1.27685165e+03, 1.05537363e+03],
       [2.00000000e+00, 1.27637826e+03, 1.10934348e+03],
       [2.00000000e+00, 1.27776289e+03, 1.25349485e+03],
       [2.00000000e+00, 1.28373222e+03, 1.08769456e+03],
       [2.00000000e+00, 1.28052941e+03, 1.03161345e+03],
       [2.00000000e+00, 1.28121739e+03, 1.29705797e+03],
       [2.00000000e+00, 1.28914216e+03, 1.12124020e+03],
       [2.00000000e+00, 1.28731452e+03, 1.04151613e+03],
       [2.00000000e+00, 1.29030841e+03, 1.00780374e+03],
       [2.00000000e+00, 1.29325301e+03, 1.13526506e+03],
       [2.00000000e+00, 1.29259551e+03, 1.23957865e+03],
       [2.00000000e+00, 1.29374242e+03, 1.05472727e+03],
       [2.00000000e+00, 1.29488554e+03, 1.09443373e+03],
       [2.00000000e+00, 1.29433544e+03, 1.19741139e+03],
       [2.00000000e+00, 1.29490265e+03, 1.21288496e+03],
       [2.00000000e+00, 1.29660000e+03, 1.07444000e+03],
       [2.00000000e+00, 1.29580769e+03, 1.18414423e+03],
       [2.00000000e+00, 1.29661429e+03, 1.25181429e+03],
       [2.00000000e+00, 1.29711111e+03, 1.26706838e+03],
       [2.00000000e+00, 1.29782500e+03, 1.00297500e+03]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>_segmentation</span></div><div class='xr-var-dims'>(y, x)</div><div class='xr-var-dtype'>uint16</div><div class='xr-var-preview xr-preview'>0 0 0 0 0 25 25 ... 0 0 0 0 0 0 0</div><input id='attrs-1f60d932-62d0-4426-9a61-61618db02eac' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-1f60d932-62d0-4426-9a61-61618db02eac' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-632ff76a-8d42-4b33-8e00-d0368fd966b1' class='xr-var-data-in' type='checkbox'><label for='data-632ff76a-8d42-4b33-8e00-d0368fd966b1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[  0,   0,   0, ...,   0,   0,   0],
       [  0,   0,   0, ...,   0,  37,  37],
       [  0,   0,   0, ...,   0,  37,  37],
       ...,
       [296, 296, 296, ...,   0,   0,   0],
       [296, 296, 296, ...,   0,   0,   0],
       [296, 296, 296, ...,   0,   0,   0]], dtype=uint16)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-13e4e3b7-f1df-449e-903b-65cfb8bce203' class='xr-section-summary-in' type='checkbox'  ><label for='section-13e4e3b7-f1df-449e-903b-65cfb8bce203' class='xr-section-summary' >Indexes: <span>(7)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>labels</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-dddcfbf9-69a0-45b0-b9b7-e4f245fb8c05' class='xr-index-data-in' type='checkbox'/><label for='index-dddcfbf9-69a0-45b0-b9b7-e4f245fb8c05' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([1, 2, 3], dtype=&#x27;int64&#x27;, name=&#x27;labels&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>la_props</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-c5949b9e-3d29-4417-9f30-73b49fff813a' class='xr-index-data-in' type='checkbox'/><label for='index-c5949b9e-3d29-4417-9f30-73b49fff813a' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;_color&#x27;, &#x27;_name&#x27;], dtype=&#x27;object&#x27;, name=&#x27;la_props&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>channels</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-75c50024-cb04-4f66-8f0a-27d2aca1f108' class='xr-index-data-in' type='checkbox'/><label for='index-75c50024-cb04-4f66-8f0a-27d2aca1f108' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;CD11c&#x27;, &#x27;CD68&#x27;, &#x27;DAPI&#x27;], dtype=&#x27;object&#x27;, name=&#x27;channels&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>x</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-80f54c77-8ae9-41a0-80f1-33e3d8197d72' class='xr-index-data-in' type='checkbox'/><label for='index-80f54c77-8ae9-41a0-80f1-33e3d8197d72' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([1000, 1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009,
       ...
       1291, 1292, 1293, 1294, 1295, 1296, 1297, 1298, 1299, 1300],
      dtype=&#x27;int64&#x27;, name=&#x27;x&#x27;, length=301))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>y</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-2bf654f0-7d71-4101-8081-d41f30cb1911' class='xr-index-data-in' type='checkbox'/><label for='index-2bf654f0-7d71-4101-8081-d41f30cb1911' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([1000, 1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009,
       ...
       1291, 1292, 1293, 1294, 1295, 1296, 1297, 1298, 1299, 1300],
      dtype=&#x27;int64&#x27;, name=&#x27;y&#x27;, length=301))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>cells</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-103453ed-ab97-4ac4-a85b-4a5ce58972b5' class='xr-index-data-in' type='checkbox'/><label for='index-103453ed-ab97-4ac4-a85b-4a5ce58972b5' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([  1,   2,   3,   4,   5,   6,   7,   8,   9,  10,
       ...
       287, 288, 289, 290, 291, 292, 293, 294, 295, 296],
      dtype=&#x27;int64&#x27;, name=&#x27;cells&#x27;, length=296))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>features</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-546854eb-3a73-4a95-8960-6798eb5f61aa' class='xr-index-data-in' type='checkbox'/><label for='index-546854eb-3a73-4a95-8960-6798eb5f61aa' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;_labels&#x27;, &#x27;centroid-0&#x27;, &#x27;centroid-1&#x27;], dtype=&#x27;object&#x27;, name=&#x27;features&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-7953e927-4161-4062-9be3-2ac6d2f177b8' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-7953e927-4161-4062-9be3-2ac6d2f177b8' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># adding colors to match the channel colors</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;deepskyblue&quot;</span><span class="p">,</span> <span class="s2">&quot;darkred&quot;</span><span class="p">]</span>
<span class="n">ds_cellpose_merged</span> <span class="o">=</span> <span class="n">ds_cellpose_merged</span><span class="o">.</span><span class="n">la</span><span class="o">.</span><span class="n">set_label_colors</span><span class="p">([</span><span class="s2">&quot;Lymphocyte&quot;</span><span class="p">,</span> <span class="s2">&quot;Dendritic Cell&quot;</span><span class="p">,</span> <span class="s2">&quot;Macrophage&quot;</span><span class="p">],</span> <span class="n">colors</span><span class="p">)</span>

<span class="c1"># merged masks</span>
<span class="n">_</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ds_cellpose_merged</span><span class="o">.</span><span class="n">pp</span><span class="p">[[</span><span class="s2">&quot;DAPI&quot;</span><span class="p">,</span> <span class="s2">&quot;CD11c&quot;</span><span class="p">,</span> <span class="s2">&quot;CD68&quot;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">colorize</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
    <span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">render_segmentation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ds_cellpose_merged</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">(</span>
    <span class="n">render_image</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">render_segmentation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">render_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Segmentation_26_0.png" src="../_images/notebooks_Segmentation_26_0.png" />
</div>
</div>
<p>Note that this method is far from perfect, and does not always pick up on all masks. In this case, you might want to look into fine-tuning cellpose to your celltype of interest. You can also tweak the cellpose parameters to try to improve the segmentation.</p>
</section>
<section id="Merging-Segmentation-Masks-from-Different-Layers">
<h2>Merging Segmentation Masks from Different Layers<a class="headerlink" href="#Merging-Segmentation-Masks-from-Different-Layers" title="Link to this heading">¶</a></h2>
<p>In the previous section, we looked at how to merge masks from a single layer. But what do we do if we have multiple segmentations in different layers?</p>
<p>Let us consider an example. Mesmer always requires two channels to segment an image (a nuclear and a membrane stain). We can run mesmer on our membrane stain, and then run cellpose on the macrophages and dendritic cells. However, now our segmentation masks are stored in different layers. The good thing is, we can combine them just as easily by using <code class="docutils literal notranslate"><span class="pre">pp.merge_segmentation()</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># running mesmer and cellpose to obtain a bunch of different segmentation masks</span>
<span class="c1"># these are stored in the layers dapi_seg, macro_seg, and dendritic_seg</span>
<span class="n">ds_mesmer</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">mesmer</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DAPI&quot;</span><span class="p">,</span> <span class="s2">&quot;Na/K ATPase&quot;</span><span class="p">],</span> <span class="n">key_added</span><span class="o">=</span><span class="s2">&quot;dapi_seg&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">cellpose</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="s2">&quot;CD68&quot;</span><span class="p">,</span> <span class="n">key_added</span><span class="o">=</span><span class="s2">&quot;macro_seg&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">cellpose</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="s2">&quot;CD11c&quot;</span><span class="p">,</span> <span class="n">key_added</span><span class="o">=</span><span class="s2">&quot;dendritic_seg&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">ds_mesmer</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Checking for cached data
Checking MultiplexSegmentation-9.tar.gz against provided file_hash...
MultiplexSegmentation-9.tar.gz with hash a1dfbce2594f927b9112f23a0a1739e0 already available.
Extracting /home/meyerben/.deepcell/models/MultiplexSegmentation-9.tar.gz
Successfully extracted /home/meyerben/.deepcell/models/MultiplexSegmentation-9.tar.gz into /home/meyerben/.deepcell/models
No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Converting image dtype to float
Neither TORCH CUDA nor MPS version not installed/working.
&gt;&gt;&gt;&gt; using CPU
&gt;&gt;&gt;&gt; using CPU
&gt;&gt; cyto3 &lt;&lt; model set to be used
&gt;&gt;&gt;&gt; loading model /home/meyerben/.cellpose/models/cyto3
resnet_torch.py (280): You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don&#39;t have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
&gt;&gt;&gt;&gt; model diam_mean =  30.000 (ROIs rescaled to this size during training)
channels set to [0, 0]
~~~ ESTIMATING CELL DIAMETER(S) ~~~
estimated cell diameter(s) in 3.49 sec
&gt;&gt;&gt; diameter(s) =
[ 20.71 ]
~~~ FINDING MASKS ~~~
&gt;&gt;&gt;&gt; TOTAL TIME 8.44 sec
Neither TORCH CUDA nor MPS version not installed/working.
&gt;&gt;&gt;&gt; using CPU
&gt;&gt;&gt;&gt; using CPU
&gt;&gt; cyto3 &lt;&lt; model set to be used
&gt;&gt;&gt;&gt; loading model /home/meyerben/.cellpose/models/cyto3
resnet_torch.py (280): You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don&#39;t have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
&gt;&gt;&gt;&gt; model diam_mean =  30.000 (ROIs rescaled to this size during training)
channels set to [0, 0]
~~~ ESTIMATING CELL DIAMETER(S) ~~~
estimated cell diameter(s) in 3.48 sec
&gt;&gt;&gt; diameter(s) =
[ 24.81 ]
~~~ FINDING MASKS ~~~
&gt;&gt;&gt;&gt; TOTAL TIME 7.04 sec
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:        (channels: 4, y: 301, x: 301)
Coordinates:
  * channels       (channels) &lt;U11 &#x27;DAPI&#x27; &#x27;Na/K ATPase&#x27; &#x27;CD68&#x27; &#x27;CD11c&#x27;
  * x              (x) int64 1000 1001 1002 1003 1004 ... 1297 1298 1299 1300
  * y              (y) int64 1000 1001 1002 1003 1004 ... 1297 1298 1299 1300
Data variables:
    _image         (channels, y, x) uint8 dask.array&lt;chunksize=(4, 301, 301), meta=np.ndarray&gt;
    dapi_seg       (y, x) int64 11 11 11 11 11 11 11 ... 348 348 348 348 348 348
    macro_seg      (y, x) uint16 0 0 0 0 0 0 0 0 0 0 0 ... 0 0 0 0 0 0 0 0 0 0 0
    dendritic_seg  (y, x) uint16 0 0 0 0 0 0 0 0 0 0 0 ... 0 0 0 0 0 0 0 0 0 0 0</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-4d7969bb-f607-45f8-bd93-9c08bc831dd4' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-4d7969bb-f607-45f8-bd93-9c08bc831dd4' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>channels</span>: 4</li><li><span class='xr-has-index'>y</span>: 301</li><li><span class='xr-has-index'>x</span>: 301</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-cc03a8a1-fc38-4b37-a310-369be5b7ab40' class='xr-section-summary-in' type='checkbox'  checked><label for='section-cc03a8a1-fc38-4b37-a310-369be5b7ab40' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>channels</span></div><div class='xr-var-dims'>(channels)</div><div class='xr-var-dtype'>&lt;U11</div><div class='xr-var-preview xr-preview'>&#x27;DAPI&#x27; &#x27;Na/K ATPase&#x27; &#x27;CD68&#x27; &#x27;CD11c&#x27;</div><input id='attrs-2132324a-435e-4547-b9ce-892f7f63a1a1' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2132324a-435e-4547-b9ce-892f7f63a1a1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7332a640-6a49-41c6-bb36-295775afcc12' class='xr-var-data-in' type='checkbox'><label for='data-7332a640-6a49-41c6-bb36-295775afcc12' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;DAPI&#x27;, &#x27;Na/K ATPase&#x27;, &#x27;CD68&#x27;, &#x27;CD11c&#x27;], dtype=&#x27;&lt;U11&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>x</span></div><div class='xr-var-dims'>(x)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1000 1001 1002 ... 1298 1299 1300</div><input id='attrs-d08cc9fe-5671-42ce-b4ce-e34d2b7af100' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d08cc9fe-5671-42ce-b4ce-e34d2b7af100' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-674c7f24-ddaa-4111-b18d-be440005f5a4' class='xr-var-data-in' type='checkbox'><label for='data-674c7f24-ddaa-4111-b18d-be440005f5a4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1000, 1001, 1002, ..., 1298, 1299, 1300])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>y</span></div><div class='xr-var-dims'>(y)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1000 1001 1002 ... 1298 1299 1300</div><input id='attrs-1e925d43-3bb3-4556-a0dd-7cbd12a79da8' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-1e925d43-3bb3-4556-a0dd-7cbd12a79da8' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7460a7d4-c98a-4466-b1a2-392269cf8722' class='xr-var-data-in' type='checkbox'><label for='data-7460a7d4-c98a-4466-b1a2-392269cf8722' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1000, 1001, 1002, ..., 1298, 1299, 1300])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-c9873947-d123-467c-8576-85c55af1732f' class='xr-section-summary-in' type='checkbox'  checked><label for='section-c9873947-d123-467c-8576-85c55af1732f' class='xr-section-summary' >Data variables: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>_image</span></div><div class='xr-var-dims'>(channels, y, x)</div><div class='xr-var-dtype'>uint8</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(4, 301, 301), meta=np.ndarray&gt;</div><input id='attrs-376bdfd4-51a5-4f07-b052-86c79c0c87f3' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-376bdfd4-51a5-4f07-b052-86c79c0c87f3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-959dcdec-899c-42e5-9dba-b96d838cb0f9' class='xr-var-data-in' type='checkbox'><label for='data-959dcdec-899c-42e5-9dba-b96d838cb0f9' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>

                    <tr>
                        <th> Bytes </th>
                        <td> 353.91 kiB </td>
                        <td> 353.91 kiB </td>
                    </tr>

                    <tr>
                        <th> Shape </th>
                        <td> (4, 301, 301) </td>
                        <td> (4, 301, 301) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 1 chunks in 3 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> uint8 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="195" height="185" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="25" y2="15" style="stroke-width:2" />
  <line x1="10" y1="120" x2="25" y2="135" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="120" style="stroke-width:2" />
  <line x1="25" y1="15" x2="25" y2="135" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 25.77971986703342,15.779719867033421 25.77971986703342,135.7797198670334 10.0,120.0" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="130" y2="0" style="stroke-width:2" />
  <line x1="25" y1="15" x2="145" y2="15" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="25" y2="15" style="stroke-width:2" />
  <line x1="130" y1="0" x2="145" y2="15" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 130.0,0.0 145.7797198670334,15.779719867033421 25.77971986703342,15.779719867033421" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="25" y1="15" x2="145" y2="15" style="stroke-width:2" />
  <line x1="25" y1="135" x2="145" y2="135" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="25" y1="15" x2="25" y2="135" style="stroke-width:2" />
  <line x1="145" y1="15" x2="145" y2="135" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="25.77971986703342,15.779719867033421 145.7797198670334,15.779719867033421 145.7797198670334,135.7797198670334 25.77971986703342,135.7797198670334" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="85.779720" y="155.779720" font-size="1.0rem" font-weight="100" text-anchor="middle" >301</text>
  <text x="165.779720" y="75.779720" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,165.779720,75.779720)">301</text>
  <text x="7.889860" y="147.889860" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,7.889860,147.889860)">4</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>dapi_seg</span></div><div class='xr-var-dims'>(y, x)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>11 11 11 11 11 ... 348 348 348 348</div><input id='attrs-eae6cce4-7a28-4d57-b9eb-db8563cb4e07' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-eae6cce4-7a28-4d57-b9eb-db8563cb4e07' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e57ce713-0639-46ad-9784-94d0e81d0741' class='xr-var-data-in' type='checkbox'><label for='data-e57ce713-0639-46ad-9784-94d0e81d0741' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[ 11,  11,  11, ...,   0,   0,   0],
       [ 11,  11,  11, ...,   8,   8,   8],
       [ 11,  11,  11, ...,   8,   8,   8],
       ...,
       [354, 354, 354, ..., 348, 348, 348],
       [354, 354, 354, ..., 348, 348, 348],
       [354, 354, 354, ..., 348, 348, 348]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>macro_seg</span></div><div class='xr-var-dims'>(y, x)</div><div class='xr-var-dtype'>uint16</div><div class='xr-var-preview xr-preview'>0 0 0 0 0 0 0 0 ... 0 0 0 0 0 0 0 0</div><input id='attrs-859267d2-936b-47a2-97e1-d5818ac36436' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-859267d2-936b-47a2-97e1-d5818ac36436' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-31746c75-7c0e-4265-a610-23844e46f3f2' class='xr-var-data-in' type='checkbox'><label for='data-31746c75-7c0e-4265-a610-23844e46f3f2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[0, 0, 0, ..., 0, 0, 0],
       [0, 0, 0, ..., 0, 0, 0],
       [0, 0, 0, ..., 0, 0, 0],
       ...,
       [0, 0, 0, ..., 0, 0, 0],
       [0, 0, 0, ..., 0, 0, 0],
       [0, 0, 0, ..., 0, 0, 0]], dtype=uint16)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>dendritic_seg</span></div><div class='xr-var-dims'>(y, x)</div><div class='xr-var-dtype'>uint16</div><div class='xr-var-preview xr-preview'>0 0 0 0 0 0 0 0 ... 0 0 0 0 0 0 0 0</div><input id='attrs-45615613-5cae-4ea7-b4df-19ca8fbef8b7' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-45615613-5cae-4ea7-b4df-19ca8fbef8b7' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e5e66535-7125-4b59-9d74-e56e6c984724' class='xr-var-data-in' type='checkbox'><label for='data-e5e66535-7125-4b59-9d74-e56e6c984724' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[0, 0, 0, ..., 0, 0, 0],
       [0, 0, 0, ..., 0, 0, 0],
       [0, 0, 0, ..., 0, 0, 0],
       ...,
       [0, 0, 0, ..., 0, 0, 0],
       [0, 0, 0, ..., 0, 0, 0],
       [0, 0, 0, ..., 0, 0, 0]], dtype=uint16)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-1b087df4-018b-4161-9cf2-b352dcf91d76' class='xr-section-summary-in' type='checkbox'  ><label for='section-1b087df4-018b-4161-9cf2-b352dcf91d76' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>channels</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-fd3c80f9-afb7-48d7-a73f-5a1242d79697' class='xr-index-data-in' type='checkbox'/><label for='index-fd3c80f9-afb7-48d7-a73f-5a1242d79697' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;DAPI&#x27;, &#x27;Na/K ATPase&#x27;, &#x27;CD68&#x27;, &#x27;CD11c&#x27;], dtype=&#x27;object&#x27;, name=&#x27;channels&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>x</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-424ce851-16a7-4ca6-939a-a5f45938d2f2' class='xr-index-data-in' type='checkbox'/><label for='index-424ce851-16a7-4ca6-939a-a5f45938d2f2' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([1000, 1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009,
       ...
       1291, 1292, 1293, 1294, 1295, 1296, 1297, 1298, 1299, 1300],
      dtype=&#x27;int64&#x27;, name=&#x27;x&#x27;, length=301))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>y</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-a1e076da-1db0-49c2-86c6-60f31fa2344d' class='xr-index-data-in' type='checkbox'/><label for='index-a1e076da-1db0-49c2-86c6-60f31fa2344d' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([1000, 1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009,
       ...
       1291, 1292, 1293, 1294, 1295, 1296, 1297, 1298, 1299, 1300],
      dtype=&#x27;int64&#x27;, name=&#x27;y&#x27;, length=301))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-745f7851-3adf-4414-94ff-6298d9f75e08' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-745f7851-3adf-4414-94ff-6298d9f75e08' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plotting the individual masks</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ds_mesmer</span><span class="o">.</span><span class="n">pp</span><span class="p">[[</span><span class="s2">&quot;DAPI&quot;</span><span class="p">,</span> <span class="s2">&quot;Na/K ATPase&quot;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">colorize</span><span class="p">([</span><span class="s2">&quot;gold&quot;</span><span class="p">,</span> <span class="s2">&quot;deepskyblue&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">render_segmentation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">segmentation_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;layer_key&quot;</span><span class="p">:</span> <span class="s2">&quot;dapi_seg&quot;</span><span class="p">},</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ds_mesmer</span><span class="o">.</span><span class="n">pp</span><span class="p">[[</span><span class="s2">&quot;DAPI&quot;</span><span class="p">,</span> <span class="s2">&quot;CD68&quot;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">colorize</span><span class="p">([</span><span class="s2">&quot;gold&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">render_segmentation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">segmentation_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;layer_key&quot;</span><span class="p">:</span> <span class="s2">&quot;macro_seg&quot;</span><span class="p">},</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ds_mesmer</span><span class="o">.</span><span class="n">pp</span><span class="p">[[</span><span class="s2">&quot;DAPI&quot;</span><span class="p">,</span> <span class="s2">&quot;CD11c&quot;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">colorize</span><span class="p">([</span><span class="s2">&quot;gold&quot;</span><span class="p">,</span> <span class="s2">&quot;deepskyblue&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">render_segmentation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">segmentation_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;layer_key&quot;</span><span class="p">:</span> <span class="s2">&quot;dendritic_seg&quot;</span><span class="p">},</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Segmentation_30_0.png" src="../_images/notebooks_Segmentation_30_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># merging the segmentation masks and making the merged segmentation the default one</span>
<span class="n">ds_mesmer</span> <span class="o">=</span> <span class="n">ds_mesmer</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">merge_segmentation</span><span class="p">(</span>
    <span class="n">layer_key</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dendritic_seg&quot;</span><span class="p">,</span> <span class="s2">&quot;macro_seg&quot;</span><span class="p">,</span> <span class="s2">&quot;dapi_seg&quot;</span><span class="p">],</span>
    <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Dendritic Cell&quot;</span><span class="p">,</span> <span class="s2">&quot;Macrophage&quot;</span><span class="p">,</span> <span class="s2">&quot;Lymphocyte&quot;</span><span class="p">],</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">add_segmentation</span><span class="p">(</span><span class="s2">&quot;_merged_segmentation&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># adding colors to match the channel colors</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;deepskyblue&quot;</span><span class="p">,</span> <span class="s2">&quot;darkred&quot;</span><span class="p">]</span>
<span class="n">ds_mesmer</span> <span class="o">=</span> <span class="n">ds_mesmer</span><span class="o">.</span><span class="n">la</span><span class="o">.</span><span class="n">set_label_colors</span><span class="p">([</span><span class="s2">&quot;Lymphocyte&quot;</span><span class="p">,</span> <span class="s2">&quot;Dendritic Cell&quot;</span><span class="p">,</span> <span class="s2">&quot;Macrophage&quot;</span><span class="p">],</span> <span class="n">colors</span><span class="p">)</span>

<span class="c1"># merged masks</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ds_mesmer</span><span class="o">.</span><span class="n">pp</span><span class="p">[[</span><span class="s2">&quot;DAPI&quot;</span><span class="p">,</span> <span class="s2">&quot;CD11c&quot;</span><span class="p">,</span> <span class="s2">&quot;CD68&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">colorize</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">render_segmentation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ds_mesmer</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">render_image</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">render_segmentation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">render_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Segmentation_32_0.png" src="../_images/notebooks_Segmentation_32_0.png" />
</div>
</div>
</section>
</section>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="Slicing.html" title="previous page">Subselecting Data</a>
    <a class='right-next' id="next-link" href="ArtifactRemoval.html" title="next page">Interactive Removal of Artifacts</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Matthias Meyer-Bender, Harald Vohringer<br/>
        
            &copy; Copyright 2024, Matthias Meyer-Bender, Harald Vohringer.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>